"use strict";const CON_ELLIPSE_CURVE_LENGTH=.552284749831;class CPoint extends CDataClass{constructor(t,i){super(),this.x=0,this.y=0,null!=t&&(this.x=t),null!=i&&(this.y=i)}doToData(t){super.doToData(t),CDataClass.putData(t,"x",this.x,0),CDataClass.putData(t,"y",this.y,0)}doFromData(t){super.doFromData(t),this.x=CDataClass.getData(t,"x",0),this.y=CDataClass.getData(t,"y",0)}toNotifyPoint(){return new CNotifyPoint(this.x,this.y)}toString(){return this.x+","+this.y}copyFrom(t){this.x=t.x,this.y=t.y}static getAngleToPoint(t,i,e,a,n=0){function o(t){return t/180*Math.PI}return new CPoint(i*Math.cos(o(a+n))+t.x,e*Math.sin(o(a+n))+t.y)}static getAngleDistance(t,i){return{angle:CPoint.getAngleFromTwoPoint(t,i),distance:CPoint.getDistancePoints(t,i)}}static getAngleFromTwoPoint(t,i){if(t.x==i.x&&t.y==i.y)return 0;if(t.x==i.x)return t.y<i.y?90:270;if(t.y==i.y)return t.x<i.x?0:180;let e=180*Math.atan((i.y-t.y)/(i.x-t.x))/Math.PI;return i.x<t.x&&i.y<t.y?e=90+(90+e):i.x<t.x&&i.y>=t.y?e=90+(90+e):i.x>=t.x&&i.y<t.y&&(e=270+(90+e)),e}static getTransAnglePoint(t,i,e){let a=i.x-t.x,n=i.y-t.y;if(0==a&&0==n)return t;{let o=Math.sqrt(a*a+n*n);return this.getAngleToPoint(i,o,o,this.getAngleFromTwoPoint(i,t)+e)}}static getDistancePoints(t,i){let e=CCalc.max(t.x,i.x)-CCalc.min(t.x,i.x),a=CCalc.max(t.y,i.y)-CCalc.min(t.y,i.y);return Math.abs(Math.sqrt(e*e+a*a))}static getLineMiddlePoint(t,i,e){return new CPoint(t.x+(i.x-t.x)*e,t.y+(i.y-t.y)*e)}static getPointer(t,i){let e=new CPoint(0,0);return null==i||"offset"==i?(e.x=t.offsetX,e.y=t.offsetY):"page"==i?(e.x=t.pageX,e.y=t.pageY):"screen"==i&&(e.x=t.screenX,e.y=t.screenY),e}static getCrossPoint(t,i,e,a){let n,o=(t.x-i.x)*(e.y-a.y)-(t.y-i.y)*(e.x-a.x);if(0!=o){let s=t.x*i.y-t.y*i.x,h=e.x*a.y-e.y*a.x,r=(s*(e.x-a.x)-(t.x-i.x)*h)/o,C=(s*(e.y-a.y)-(t.y-i.y)*h)/o;n=new CPoint(r,C)}return n}static isInLine(t,i,e){return CPoint.getAngleFromTwoPoint(t,e)==CPoint.getAngleFromTwoPoint(t,i)}static isInCross(t,i,e,a){let n=CPoint.getCrossPoint(t,i,e,a);return null!=n&&(CPoint.isInLine(t,i,n)&&CPoint.isInLine(e,a,n))}static isCrossLineAndPoligon(t,i,e){let a=!1;for(let n=0;n<t.length-1;n++)if(CPoint.isInCross(t[n],t[n+1],i,e)){a=!0;break}return a}static isCrossPoligon(t,i){let e=!1;for(let a=0;a<t.length-1;a++)for(let n=0;n<i.length-1;n++)if(CPoint.isInCross(t[a],t[a+1],i[n],i[n+1])){e=!0;break}return e}static getArrowPoint(t,i,e,a){let n=this.getAngleFromTwoPoint(t,i)-180;return{arrow1:this.getAngleToPoint(i,a,a,e,n),arrow2:this.getAngleToPoint(i,a,a,-e,n)}}static getBezierMiddlePoint(t,i,e,a,n){let o=this.getLineMiddlePoint(t,i,n),s=this.getLineMiddlePoint(i,e,n),h=this.getLineMiddlePoint(e,a,n),r=this.getLineMiddlePoint(o,s,n),C=this.getLineMiddlePoint(s,h,n);return this.getLineMiddlePoint(r,C,n)}static getBezier2MiddlePoint(t,i,e,a){let n=this.getLineMiddlePoint(t,i,a),o=this.getLineMiddlePoint(i,e,a);return this.getLineMiddlePoint(n,o,a)}static getBezierMiddlePointFromPoints(t,i){function e(t){let i=new Array;for(let e=0;e<t.length;e++)i.push(new CPoint(t[e].x,t[e].y));return i}let a,n;for(a=e(t);;){n=[];for(let t=0;t<a.length-1;t++)n.push(this.getLineMiddlePoint(a[t],a[t+1],i));if(n.length<=2)break;a=e(n)}return this.getLineMiddlePoint(n[0],n[1],i)}static getLineCenterAngleToPoint(t,i,e,a,n){let o=180*Math.atan((i.y-t.y)/(i.x-t.x))/Math.PI;i.x<t.x&&i.y<t.y?o=90+(90+o):i.x<t.x&&i.y>=t.y?o=90+(90+o):i.x>=t.x&&i.y<t.y&&(o=270+(90+o));let s=(CCalc.max(t.x,i.x)-CCalc.min(t.x,i.x))/2+CCalc.min(t.x,i.x),h=(CCalc.max(t.y,i.y)-CCalc.min(t.y,i.y))/2+CCalc.min(t.y,i.y);return this.getAngleToPoint(new CPoint(s,h),e,a,n+o)}static getLineMiddleAngleToPoint(t,i,e,a,n,o){let s=180*Math.atan((i.y-t.y)/(i.x-t.x))/Math.PI;i.x<t.x&&i.y<t.y?s=90+(90+s):i.x<t.x&&i.y>=t.y?s=90+(90+s):i.x>=t.x&&i.y<t.y&&(s=270+(90+s));let h=(CCalc.max(t.x,i.x)-CCalc.min(t.x,i.x))*(1-o)+CCalc.min(t.x,i.x),r=(CCalc.max(t.y,i.y)-CCalc.min(t.y,i.y))*(1-o)+CCalc.min(t.y,i.y);return this.getAngleToPoint(new CPoint(h,r),e,a,n+s)}static getPoligonPoints(t,i=!1,e){let a=new CList,n=360/t;for(let i=0;i<t;i++)a.add(CPoint.getAngleToPoint(new CPoint(.5,.5),.5,.5,i*n,e));return i&&a.add(CPoint.getAngleToPoint(new CPoint(.5,.5),.5,.5,0,e)),a}static getHornPoints(t,i,e=!1,a){let n=new CList,o=360/(2*t);for(let e=0;e<2*t;e++)e%2==0?n.add(CPoint.getAngleToPoint(new CPoint(.5,.5),.5,.5,e*o,a)):n.add(CPoint.getAngleToPoint(new CPoint(.5,.5),.5*i,.5*i,e*o,a));return e&&n.add(CPoint.getAngleToPoint(new CPoint(.5,.5),.5,.5,0,a)),n}static create(t=0,i=0){return new CPoint(t,i)}static getDefaultData(){return{x:0,y:0}}static getTransformPoint(t,i,e,a,n,o){let s=new CPoint,h=(i.x-t.left)/t.width,r=(i.y-t.top)/t.height,C=CPoint.getLineMiddlePoint(e,n,r).x,l=CPoint.getLineMiddlePoint(a,o,r).x,g=CPoint.getLineMiddlePoint(e,a,h).y,d=CPoint.getLineMiddlePoint(n,o,h).y;return s.x=CCalc.crRange2Value(t.left,t.right,i.x,C,l),s.y=CCalc.crRange2Value(t.top,t.bottom,i.y,g,d),s}static getTransformCurvePoint(t,i,e,a,n,o,s,h,r,C,l,g,d,P){let p=new CPoint,_=(i.x-t.left)/t.width,c=(i.y-t.top)/t.height,u=CPoint.xTransformLine(e,a,n,o,s,h,r,C,l,g,d,P,_),E=CPoint.yTransformLine(e,a,n,o,s,h,r,C,l,g,d,P,c);return p.x=CPoint.getBezierMiddlePoint(u.startPoint,u.curve1,u.curve2,u.stopPoint,c).x,p.y=CPoint.getBezierMiddlePoint(E.startPoint,E.curve1,E.curve2,E.stopPoint,_).y,p}static getMiddleCurveLineFromTwoLine(t,i,e,a,n,o,s,h,r){let C=CPoint.getLineMiddlePoint(t,n,r),l=CPoint.getLineMiddlePoint(a,h,r);return{startPoint:C,curve1:CPoint.getLineMiddlePoint(i,o,r),curve2:CPoint.getLineMiddlePoint(e,s,r),stopPoint:l}}static xTransformLine(t,i,e,a,n,o,s,h,r,C,l,g,d){let P=CPoint.getLineMiddlePoint(t,i,d),p=CPoint.getLineMiddlePoint(e,a,d),_=CPoint.getDistancePoints(P,p),c=CPoint.getBezierMiddlePoint(t,s,h,i,d),u=CPoint.getBezierMiddlePoint(e,l,g,a,d),E=CPoint.getDistancePoints(c,u)/_,f=CPoint.getMiddleCurveLineFromTwoLine(t,n,o,e,i,r,C,a,d);f.startPoint.x*=E,f.stopPoint.x*=E,f.curve1.x*=E,f.curve2.x*=E,f.startPoint.y*=E,f.stopPoint.y*=E,f.curve1.y*=E,f.curve2.y*=E;let D=c.x-f.startPoint.x;f.startPoint.x+=D,f.stopPoint.x+=D,f.curve1.x+=D,f.curve2.x+=D;let m=c.y-f.startPoint.y;f.startPoint.y+=m,f.stopPoint.y+=m,f.curve1.y+=m,f.curve2.y+=m;let T=CPoint.getAngleFromTwoPoint(P,p),N=CPoint.getAngleFromTwoPoint(c,u);return f.curve1=CPoint.getTransAnglePoint(f.curve1,f.startPoint,N-T),f.curve2=CPoint.getTransAnglePoint(f.curve2,f.startPoint,N-T),f.stopPoint=CPoint.getTransAnglePoint(f.stopPoint,f.startPoint,N-T),{startPoint:f.startPoint,curve1:f.curve1,curve2:f.curve2,stopPoint:f.stopPoint}}static yTransformLine(t,i,e,a,n,o,s,h,r,C,l,g,d){let P=CPoint.getLineMiddlePoint(t,e,d),p=CPoint.getLineMiddlePoint(i,a,d),_=CPoint.getDistancePoints(P,p),c=CPoint.getBezierMiddlePoint(t,n,o,e,d),u=CPoint.getBezierMiddlePoint(i,r,C,a,d),E=CPoint.getDistancePoints(c,u)/_,f=CPoint.getMiddleCurveLineFromTwoLine(t,s,h,i,e,l,g,a,d);f.startPoint.x*=E,f.stopPoint.x*=E,f.curve1.x*=E,f.curve2.x*=E,f.startPoint.y*=E,f.stopPoint.y*=E,f.curve1.y*=E,f.curve2.y*=E;let D=c.x-f.startPoint.x;f.startPoint.x+=D,f.stopPoint.x+=D,f.curve1.x+=D,f.curve2.x+=D;let m=c.y-f.startPoint.y;f.startPoint.y+=m,f.stopPoint.y+=m,f.curve1.y+=m,f.curve2.y+=m;let T=CPoint.getAngleFromTwoPoint(P,p),N=CPoint.getAngleFromTwoPoint(c,u);return f.curve1=CPoint.getTransAnglePoint(f.curve1,f.startPoint,N-T),f.curve2=CPoint.getTransAnglePoint(f.curve2,f.startPoint,N-T),f.stopPoint=CPoint.getTransAnglePoint(f.stopPoint,f.startPoint,N-T),{startPoint:f.startPoint,curve1:f.curve1,curve2:f.curve2,stopPoint:f.stopPoint}}static splitLinePoints(t,i,e){let a=new Array;for(let n=1;n<=e;n++){let o=1/e*n;a.push(CPoint.getLineMiddlePoint(t,i,o))}return a}static splitCurveLinePoints(t,i,e,a,n){let o=new Array;for(let s=1;s<=n;s++){let h=1/n*s;o.push(CPoint.getBezierMiddlePoint(t,i,e,a,h))}return o}static splitCurve2LinePoints(t,i,e,a){let n=new Array;for(let o=1;o<=a;o++){let s=1/a*o;n.push(CPoint.getBezier2MiddlePoint(t,i,e,s))}return n}}class CPoint3D extends CDataClass{constructor(t=0,i=0,e=0){super(),this.x=0,this.y=0,this.z=0,this.x=t,this.y=i,this.z=e}doToData(t){super.doToData(t),CDataClass.putData(t,"x",this.x,0),CDataClass.putData(t,"y",this.y,0),CDataClass.putData(t,"z",this.z,0)}doFromData(t){super.doFromData(t),this.x=CDataClass.getData(t,"x",0),this.y=CDataClass.getData(t,"y",0),this.z=CDataClass.getData(t,"z",0)}position3DTo2D(t,i,e,a=0,n=0){let o=.8*e,s=o/(o-this.z);return{x:this.x*s+t,y:this.y*s+i,objectWidth:a*s,objectHeight:n*s}}static getAngleToPoint3D(t,i,e,a){let n=e*(Math.PI/180),o=i*(Math.PI/180);const s=a*Math.sin(n)*Math.cos(o)+t.x,h=a*Math.sin(n)*Math.sin(o)+t.y,r=a*Math.cos(n)+t.z;return new CPoint3D(s,h,r)}static getAngleToPoint3DEllipse(t,i,e,a,n,o){let s=e*(Math.PI/180),h=i*(Math.PI/180);const r=a*Math.sin(s)*Math.cos(h)+t.x,C=n*Math.sin(s)*Math.sin(h)+t.y,l=o*Math.cos(s)+t.z;return new CPoint3D(r,C,l)}static getAngleToPoint3DXY(t,i,e,a){let n=-1*CCalc.sind(i),o=a*CCalc.sind(e)*CCalc.sind(i)+t.x,s=a*CCalc.cosd(e)*n+t.y,h=a*CCalc.cosd(i)*CCalc.cosd(e)+t.z;return new CPoint3D(o,s,h)}static a(t,i){}}class CRect extends CDataClass{constructor(t=0,i=0,e=0,a=0){super(),this.left=t,this.top=i,this.right=e,this.bottom=a}get width(){return this.right-this.left}set width(t){this.right=this.left+t}get height(){return this.bottom-this.top}set height(t){this.bottom=this.top+t}set all(t){this.left=t,this.top=t,this.right=t,this.bottom=t}get leftTop(){return new CPoint(this.left,this.top)}get leftBottom(){return new CPoint(this.left,this.bottom)}get rightTop(){return new CPoint(this.right,this.top)}get rightBottom(){return new CPoint(this.right,this.bottom)}get center(){return new CPoint(this.left+this.width/2,this.top+this.height/2)}doToData(t){super.doToData(t),CDataClass.putData(t,"left",this.left,0),CDataClass.putData(t,"top",this.top,0),CDataClass.putData(t,"right",this.right,0),CDataClass.putData(t,"bottom",this.bottom,0)}doFromData(t){super.doFromData(t),this.left=CDataClass.getData(t,"left",0),this.top=CDataClass.getData(t,"top",0),this.right=CDataClass.getData(t,"right",0),this.bottom=CDataClass.getData(t,"bottom",0)}isIn(t,i){return this.left<=t&&this.right>=t&&this.top<=i&&this.bottom>=i}isInPoint(t){return this.isIn(t.x,t.y)}isInRect(t){let i=!1;return this.isInPoint(t.leftTop)&&this.isInPoint(t.leftBottom)&&this.isInPoint(t.rightTop)&&this.isInPoint(t.rightBottom)&&(i=!0),i}isIntersection(t){let i=!1;return(this.isInPoint(t.leftTop)||this.isInPoint(t.leftBottom)||this.isInPoint(t.rightTop)||this.isInPoint(t.rightBottom))&&(i=!0),(t.isInPoint(this.leftTop)||t.isInPoint(this.leftBottom)||t.isInPoint(this.rightTop)||t.isInPoint(this.rightBottom))&&(i=!0),this.isInRect(t)&&(i=!0),t.isInRect(this)&&(i=!0),t.left<this.left&&t.right>this.right&&t.top>this.top&&t.bottom<this.bottom&&(i=!0),t.left>this.left&&t.right<this.right&&t.top<this.top&&t.bottom>this.bottom&&(i=!0),this.left<t.left&&this.right>t.right&&this.top>t.top&&this.bottom<t.bottom&&(i=!0),this.left>t.left&&this.right<t.right&&this.top<t.top&&this.bottom>t.bottom&&(i=!0),i}isMinusSize(){return this.right<this.left||this.top>this.bottom}getIntersection(t){return new CRect(CCalc.max(this.left,t.left),CCalc.max(this.top,t.top),CCalc.min(this.right,t.right),CCalc.min(this.bottom,t.bottom))}copyFrom(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom}inflate(t,i){this.left=this.left-t,this.top=this.top-i,this.right=this.right+t,this.bottom=this.bottom+i}inflateTo(t,i){let e=CRect.create(this.left,this.top,this.right,this.bottom);return e.inflate(t,i),e}offset(t,i){this.left=this.left+t,this.top=this.top+i,this.right=this.right+t,this.bottom=this.bottom+i}set(t,i,e,a){this.left=t,this.top=i,this.right=e,this.bottom=a}getFitRect(t,i){let e=0,a=0,n=0,o=0,s=0,h=0;return n=t.right-t.left,o=this.right-this.left,s=t.bottom-t.top,h=this.bottom-this.top,CCalc.cr(n,s,100,0,4)>CCalc.cr(o,h,100,0,4)?(a=h,e=CCalc.cr(n,s,0,a,3),1==i?new CRect((o-e)/2,0,e+(o-e)/2,a):new CRect(0,0,e,a)):(e=o,a=CCalc.cr(n,s,e,0,4),1==i?new CRect(0,(h-a)/2,e,a+(h-a)/2):new CRect(0,0,e,a))}isEmpty(){return 0==this.left&&0==this.top&&0==this.right&&0==this.bottom}equal(t){return this.left==t.left&&this.top==t.top&&this.right==t.right&&this.bottom==t.bottom}toString(){return this.left+","+this.top+","+this.right+","+this.bottom}fromString(t){let i=t.split(",");(i.length=4)&&(this.left=parseInt(i[0]),this.top=parseInt(i[1]),this.right=parseInt(i[2]),this.bottom=parseInt(i[3]))}static create(t,i,e,a){return new CRect(t,i,e,a)}static getDefaultData(){return{left:0,top:0,right:0,bottom:0}}static newEmpty(){return CRect.create(0,0,0,0)}static copyFrom(t){return new CRect(t.left,t.top,t.right,t.bottom)}}class CNotifyPoint extends CNotifyChangeKindObject{constructor(t=0,i=0){super(),this._x=t,this._y=i}static get CON_CHANGE_X(){return"x"}static get CON_CHANGE_Y(){return"y"}get x(){return this._x}set x(t){this._x!=t&&(this._x=t,this.doChange(CNotifyPoint.CON_CHANGE_X))}get y(){return this._y}set y(t){this._y!=t&&(this._y=t,this.doChange(CNotifyPoint.CON_CHANGE_Y))}doToData(t){super.doToData(t),CDataClass.putData(t,"x",this.x,0),CDataClass.putData(t,"y",this.y,0)}doFromData(t){super.doFromData(t),this.x=CDataClass.getData(t,"x",0),this.y=CDataClass.getData(t,"y",0)}toPoint(){return new CPoint(this.x,this.y)}toString(){return this.x+","+this.y}copyTo(){return new CNotifyPoint(this.x,this.y)}isZero(){return 0==this.x&&0==this.y}static create(t,i){return new CNotifyPoint(t,i)}}class CNotifyRect extends CNotifyChangeKindObject{constructor(t=0,i=0,e=0,a=0){super(),this._left=t,this._top=i,this._right=e,this._bottom=a}static get CON_CHANGE_LEFT(){return"l"}static get CON_CHANGE_TOP(){return"t"}static get CON_CHANGE_RIGHT(){return"r"}static get CON_CHANGE_BOTTOM(){return"b"}static get CON_CHANGE_ALL(){return"a"}get left(){return this._left}set left(t){this._left!=t&&(this._left=t,this.doChange(CNotifyRect.CON_CHANGE_LEFT))}get top(){return this._top}set top(t){this._top!=t&&(this._top=t,this.doChange(CNotifyRect.CON_CHANGE_TOP))}get right(){return this._right}set right(t){this._right!=t&&(this._right=t,this.doChange(CNotifyRect.CON_CHANGE_RIGHT))}get bottom(){return this._bottom}set bottom(t){this._bottom!=t&&(this._bottom=t,this.doChange(CNotifyRect.CON_CHANGE_BOTTOM))}get width(){return this._right-this._left}set width(t){this.width!=t&&(this._right=this._left+t,this.doChange(CNotifyRect.CON_CHANGE_RIGHT))}get height(){return this._bottom-this._top}set height(t){this.height!=t&&(this._bottom=this._top+t,this.doChange(CNotifyRect.CON_CHANGE_BOTTOM))}set all(t){this._left=t,this._top=t,this._right=t,this._bottom=t,this.doChange(CNotifyRect.CON_CHANGE_ALL)}get leftTop(){return new CPoint(this.left,this.top)}get leftBottom(){return new CPoint(this.left,this.bottom)}get rightTop(){return new CPoint(this.right,this.top)}get rightBottom(){return new CPoint(this.right,this.bottom)}get rect(){return new CRect(this._left,this._top,this._right,this._bottom)}equalRect(t){return t.left==this.left&&t.top==this.top&&t.right==this.right&&t.bottom==this.bottom}doToData(t){super.doToData(t),CDataClass.putData(t,"left",this.left,0),CDataClass.putData(t,"top",this.top,0),CDataClass.putData(t,"right",this.right,0),CDataClass.putData(t,"bottom",this.bottom,0)}doFromData(t){super.doFromData(t),this.left=CDataClass.getData(t,"left",0),this.top=CDataClass.getData(t,"top",0),this.right=CDataClass.getData(t,"right",0),this.bottom=CDataClass.getData(t,"bottom",0)}}var EPathPointKind,ETextAlign,EGradientKind,EStyleKind,EStrokeLineCap,EStrokeLineJoin,ECanvasItemAlign,ECanvasItemKind,EPatternKind,EPaintKind;!function(t){t[t.BEGIN=0]="BEGIN",t[t.MOVETO=1]="MOVETO",t[t.LINETO=2]="LINETO",t[t.CURVETO2=3]="CURVETO2",t[t.CURVETO3=4]="CURVETO3",t[t.CLOSE=5]="CLOSE"}(EPathPointKind||(EPathPointKind={}));class CPathPoint extends CNotifyChangeNotifyObject{constructor(t,i,e){super(),this.pointKind=EPathPointKind.BEGIN;let a=this;this.pointKind=t,this.point=new CNotifyPoint(i,e),this.point.onChange=function(){a.doChange()},this.cPoint1=new CNotifyPoint(0,0),this.cPoint1.onChange=function(){a.doChange()},this.cPoint2=new CNotifyPoint(0,0),this.cPoint2.onChange=function(){a.doChange()}}copyTo(){let t=new CPathPoint(this.pointKind,this.point.x,this.point.y);return t.cPoint1.x=this.cPoint1.x,t.cPoint1.y=this.cPoint1.y,t.cPoint2.x=this.cPoint2.x,t.cPoint2.y=this.cPoint2.y,t}copyFrom(t){this.pointKind=t.pointKind,this.point.copyFrom(t.point),this.cPoint1.copyFrom(t.cPoint1),this.cPoint2.copyFrom(t.cPoint2)}toData(){let t={};return CDataClass.putData(t,"pointKind",this.pointKind,EPathPointKind.LINETO),CDataClass.putData(t,"point",this.point.toData(),{},!0),CDataClass.putData(t,"cPoint1",this.cPoint1.toData(),{},!0),CDataClass.putData(t,"cPoint2",this.cPoint2.toData(),{},!0),t}fromData(t){this.pointKind=CDataClass.getData(t,"pointKind",EPathPointKind.LINETO),this.point.fromData(CDataClass.getData(t,"point",{},!0)),this.cPoint1.fromData(CDataClass.getData(t,"cPoint1",{},!0)),this.cPoint2.fromData(CDataClass.getData(t,"cPoint2",{},!0))}static create(t,i,e,a){let n=new CPathPoint(t,i.x,i.y);return n.cPoint1=e.toNotifyPoint(),n.cPoint2=a.toNotifyPoint(),n}static lineTocurve(t,i,e,a){let n=new CPathPoint(EPathPointKind.CURVETO3,e,a),o=new CPoint(t,i),s=new CPoint(e,a),h=CPoint.getLineMiddlePoint(o,s,1/3);n.cPoint1.x=h.x,n.cPoint1.y=h.y;let r=CPoint.getLineMiddlePoint(o,s,1/3*2);return n.cPoint2.x=r.x,n.cPoint2.y=r.y,n}}class CPathTransformer extends CNotifyChangeNotifyObject{constructor(){super(),this._leftTop=new CNotifyPoint,this._rightTop=new CNotifyPoint,this._leftBottom=new CNotifyPoint,this._rightBottom=new CNotifyPoint,this._leftCurve1=new CNotifyPoint,this._leftCurve2=new CNotifyPoint,this._topCurve1=new CNotifyPoint,this._topCurve2=new CNotifyPoint,this._rightCurve1=new CNotifyPoint,this._rightCurve2=new CNotifyPoint,this._bottomCurve1=new CNotifyPoint,this._bottomCurve2=new CNotifyPoint;let t=this;this.leftTop.onChange=function(){t.doChange()},this.rightTop.onChange=function(){t.doChange()},this.leftBottom.onChange=function(){t.doChange()},this.rightBottom.onChange=function(){t.doChange()},this.leftCurve1.onChange=function(){t.doChange()},this.leftCurve2.onChange=function(){t.doChange()},this.topCurve1.onChange=function(){t.doChange()},this.topCurve2.onChange=function(){t.doChange()},this.rightCurve1.onChange=function(){t.doChange()},this.rightCurve2.onChange=function(){t.doChange()},this.bottomCurve1.onChange=function(){t.doChange()},this.bottomCurve2.onChange=function(){t.doChange()}}get leftTop(){return this._leftTop}get rightTop(){return this._rightTop}get leftBottom(){return this._leftBottom}get rightBottom(){return this._rightBottom}get leftCurve1(){return this._leftCurve1}get leftCurve2(){return this._leftCurve2}get rightCurve1(){return this._rightCurve1}get rightCurve2(){return this._rightCurve2}get topCurve1(){return this._topCurve1}get topCurve2(){return this._topCurve2}get bottomCurve1(){return this._bottomCurve1}get bottomCurve2(){return this._bottomCurve2}getTransformData(t,i){let e=i.copyTo();for(let a=0;a<i.length;a++)if(i.get(a).pointKind==EPathPointKind.MOVETO||i.get(a).pointKind==EPathPointKind.LINETO||i.get(a).pointKind==EPathPointKind.CURVETO2||i.get(a).pointKind==EPathPointKind.CURVETO3){let n=i.get(a).point,o=CPoint.getTransformCurvePoint(t,n.toPoint(),this.leftTop.toPoint(),this.rightTop.toPoint(),this.leftBottom.toPoint(),this.rightBottom.toPoint(),this.leftCurve1.toPoint(),this.leftCurve2.toPoint(),this.topCurve1.toPoint(),this.topCurve2.toPoint(),this.rightCurve1.toPoint(),this.rightCurve2.toPoint(),this.bottomCurve1.toPoint(),this.bottomCurve2.toPoint());e.get(a).point.x=o.x,e.get(a).point.y=o.y,n=i.get(a).cPoint1,o=CPoint.getTransformCurvePoint(t,n.toPoint(),this.leftTop.toPoint(),this.rightTop.toPoint(),this.leftBottom.toPoint(),this.rightBottom.toPoint(),this.leftCurve1.toPoint(),this.leftCurve2.toPoint(),this.topCurve1.toPoint(),this.topCurve2.toPoint(),this.rightCurve1.toPoint(),this.rightCurve2.toPoint(),this.bottomCurve1.toPoint(),this.bottomCurve2.toPoint()),e.get(a).cPoint1.x=o.x,e.get(a).cPoint1.y=o.y,n=i.get(a).cPoint2,o=CPoint.getTransformCurvePoint(t,n.toPoint(),this.leftTop.toPoint(),this.rightTop.toPoint(),this.leftBottom.toPoint(),this.rightBottom.toPoint(),this.leftCurve1.toPoint(),this.leftCurve2.toPoint(),this.topCurve1.toPoint(),this.topCurve2.toPoint(),this.rightCurve1.toPoint(),this.rightCurve2.toPoint(),this.bottomCurve1.toPoint(),this.bottomCurve2.toPoint()),e.get(a).cPoint2.x=o.x,e.get(a).cPoint2.y=o.y}return e}isEmpty(){return 0==this.leftTop.x&&0==this.leftTop.y&&0==this.rightTop.x&&0==this.rightTop.y&&0==this.leftBottom.x&&0==this.leftBottom.y&&0==this.rightBottom.x&&0==this.rightBottom.y&&0==this.leftCurve1.x&&0==this.leftCurve1.y&&0==this.leftCurve2.x&&0==this.leftCurve2.y&&0==this.topCurve1.x&&0==this.topCurve1.y&&0==this.topCurve2.x&&0==this.topCurve2.y&&0==this.rightCurve1.x&&0==this.rightCurve1.y&&0==this.rightCurve2.x&&0==this.rightCurve2.y&&0==this.bottomCurve1.x&&0==this.bottomCurve1.y&&0==this.bottomCurve2.x&&0==this.bottomCurve2.y}}class CPathPointList extends CList{constructor(){super(...arguments),this._width=0,this._height=0,this._transformer=new CPathTransformer}get width(){return this._width}set width(t){this._width!=t&&(this._width=t)}get height(){return this._height}set height(t){this._height!=t&&(this._height=t)}get transformer(){return this._transformer}set transformer(t){if(this._transformer!=t&&(this._transformer=t,this.doChange("transformer"),null!=t)){let i=this;t.onChange=function(){i.doChange("transformer")}}}doToData(t){super.doToData(t);let i=[];for(let t=0;t<this.length;t++){let e=this.get(t).toData();i.push(e)}CDataClass.putData(t,"width",this.width,0),CDataClass.putData(t,"height",this.height,0),CDataClass.putData(t,"data",i,[],!0)}doFromData(t){super.doFromData(t),this.clear(),this.width=CDataClass.getData(t,"width",0),this.height=CDataClass.getData(t,"height",0);let i=CDataClass.getData(t,"data",[],!0);for(let t=0;t<i.length;t++){let e=new CPathPoint(EPathPointKind.BEGIN,0,0);e.fromData(i[t]),this.add(e)}}toData(){let t={};return this.doToData(t),t}add(t){super.add(t);let i=this;t.onChange=function(){i.doChange("point")}}insert(t,i){super.insert(t,i);let e=this;i.onChange=function(){e.doChange("point")}}addPoint(t,i,e,a){this.add(CPathPoint.create(t,i,e,a))}addPointBegin(){this.add(CPathPoint.create(EPathPointKind.BEGIN,CPoint.create(0,0),CPoint.create(0,0),CPoint.create(0,0)))}addPointMoveTo(t){let i=CPathPoint.create(EPathPointKind.MOVETO,t,CPoint.create(0,0),CPoint.create(0,0));return this.add(i),i}addPointLineTo(t){let i=CPathPoint.create(EPathPointKind.LINETO,t,CPoint.create(0,0),CPoint.create(0,0));return this.add(i),i}addPointCurveTo2(t,i){let e=CPathPoint.create(EPathPointKind.CURVETO2,t,i,CPoint.create(0,0));return this.add(e),e}addPointCurveTo3(t,i,e){let a=CPathPoint.create(EPathPointKind.CURVETO3,t,i,e);return this.add(a),a}addArc(t,i,e,a){let n=CPoint.getAngleFromTwoPoint(t,this.get(this.length-1).point.toPoint()),o=i,s=CPoint.getAngleToPoint(t,e,a,n);if(i>0){for(;o>90;){let i=CPoint.getAngleToPoint(t,e,a,n+90),h=CON_ELLIPSE_CURVE_LENGTH,r=CPoint.getAngleToPoint(s,e*h,a*h,90,CPoint.getAngleFromTwoPoint(t,s)),C=CPoint.getAngleToPoint(i,e*h,a*h,-90,CPoint.getAngleFromTwoPoint(t,i));this.addPointCurveTo3(i,r,C),s.copyFrom(i),n+=90,o-=90}let i=CPoint.getAngleToPoint(t,e,a,n+o),h=CCalc.cr(CON_ELLIPSE_CURVE_LENGTH,0,90,o,2),r=CPoint.getAngleToPoint(s,e*h,a*h,90,CPoint.getAngleFromTwoPoint(t,s)),C=CPoint.getAngleToPoint(i,e*h,a*h,-90,CPoint.getAngleFromTwoPoint(t,i));this.addPointCurveTo3(i,r,C)}else{for(;o<-90;){let i=CPoint.getAngleToPoint(t,e,a,n-90),h=CON_ELLIPSE_CURVE_LENGTH,r=CPoint.getAngleToPoint(s,e*h,a*h,-90,CPoint.getAngleFromTwoPoint(t,s)),C=CPoint.getAngleToPoint(i,e*h,a*h,90,CPoint.getAngleFromTwoPoint(t,i));this.addPointCurveTo3(i,r,C),s.copyFrom(i),n-=90,o+=90}let i=CPoint.getAngleToPoint(t,e,a,n+o),h=CCalc.cr(CON_ELLIPSE_CURVE_LENGTH,0,90,Math.abs(o),2),r=CPoint.getAngleToPoint(s,e*h,a*h,-90,CPoint.getAngleFromTwoPoint(t,s)),C=CPoint.getAngleToPoint(i,e*h,a*h,90,CPoint.getAngleFromTwoPoint(t,i));this.addPointCurveTo3(i,r,C)}}addDecalcomanieXReverse(t,i=!0,e=!1){function a(i){let e=t-i.x;return new CPoint(t+e,i.y)}let n=new CPathPointList;n.copyFrom(this);for(let t=n.length-1;t>=0;t--){if(t==n.length-1){let e=a(new CPoint(n.get(t).point.x,n.get(t).point.y));i?this.addPointLineTo(e):this.addPointMoveTo(e)}if(t-1>=0){let i=new CPoint(n.get(t-1).point.x,n.get(t-1).point.y),e=new CPoint(n.get(t).cPoint1.x,n.get(t).cPoint1.y),o=new CPoint(n.get(t).cPoint2.x,n.get(t).cPoint2.y);switch(n.get(t).pointKind){case EPathPointKind.MOVETO:this.addPointMoveTo(a(i));break;case EPathPointKind.LINETO:this.addPointLineTo(a(i));break;case EPathPointKind.CURVETO2:this.addPointCurveTo2(a(i),a(e));break;case EPathPointKind.CURVETO3:this.addPointCurveTo3(a(i),a(o),a(e));break;case EPathPointKind.CLOSE:return}}}e&&this.addPointClose()}addDecalcomanieX(t){function i(i){let e=t-i.x;return new CPoint(t+e,i.y)}let e=new CPathPointList;e.copyFrom(this);for(let t=0;t<e.length;t++)switch(e.get(t).pointKind){case EPathPointKind.MOVETO:this.addPointMoveTo(i(e.get(t).point.toPoint()));break;case EPathPointKind.LINETO:this.addPointLineTo(i(e.get(t).point.toPoint()));break;case EPathPointKind.CURVETO2:this.addPointCurveTo2(i(e.get(t).point.toPoint()),i(e.get(t).cPoint1.toPoint()));break;case EPathPointKind.CURVETO3:this.addPointCurveTo3(i(e.get(t).point.toPoint()),i(e.get(t).cPoint1.toPoint()),i(e.get(t).cPoint2.toPoint()));break;case EPathPointKind.CLOSE:this.addPointClose()}}addDecalcomanieYReverse(t,i=!0,e=!1){function a(i){let e=t-i.y;return new CPoint(i.x,t+e)}let n=new CPathPointList;n.copyFrom(this);for(let t=n.length-1;t>=0;t--){if(t==n.length-1){let e=a(n.get(t).point.toPoint());i?this.addPointLineTo(e):this.addPointMoveTo(e)}if(t-1>=0)switch(n.get(t).pointKind){case EPathPointKind.MOVETO:this.addPointMoveTo(a(n.get(t-1).point.toPoint()));break;case EPathPointKind.LINETO:this.addPointLineTo(a(n.get(t-1).point.toPoint()));break;case EPathPointKind.CURVETO2:this.addPointCurveTo2(a(n.get(t-1).point.toPoint()),a(n.get(t).cPoint1.toPoint()));break;case EPathPointKind.CURVETO3:this.addPointCurveTo3(a(n.get(t-1).point.toPoint()),a(n.get(t).cPoint2.toPoint()),a(n.get(t).cPoint1.toPoint()));break;case EPathPointKind.CLOSE:return}}e&&this.addPointClose()}addDecalcomanieY(t){function i(i){let e=t-i.y;return new CPoint(i.x,t+e)}let e=new CPathPointList;e.copyFrom(this);for(let t=0;t<e.length;t++)switch(e.get(t).pointKind){case EPathPointKind.MOVETO:this.addPointMoveTo(i(e.get(t).point.toPoint()));break;case EPathPointKind.LINETO:this.addPointLineTo(i(e.get(t).point.toPoint()));break;case EPathPointKind.CURVETO2:this.addPointCurveTo2(i(e.get(t).point.toPoint()),i(e.get(t).cPoint1.toPoint()));break;case EPathPointKind.CURVETO3:this.addPointCurveTo3(i(e.get(t).point.toPoint()),i(e.get(t).cPoint1.toPoint()),i(e.get(t).cPoint2.toPoint()));break;case EPathPointKind.CLOSE:this.addPointClose()}}addPointClose(){if(this.length>0&&this.get(this.length-1).pointKind==EPathPointKind.CLOSE)return;let t=CPathPoint.create(EPathPointKind.CLOSE,CPoint.create(0,0),CPoint.create(0,0),CPoint.create(0,0));return this.add(t),t}deletePoint(t){if("number"==typeof t)this.length-1>t?(this.get(t+1).pointKind==EPathPointKind.CLOSE&&this.delete(t+1),this.delete(t)):this.length-1==t&&this.delete(t);else{let i=-1;for(let e=0;e<this.length;e++)if(this.get(e)==t){i=e;break}-1!=i&&(this.length-1>i?(this.get(i+1).pointKind==EPathPointKind.CLOSE&&this.delete(i+1),this.delete(i)):this.length-1==i&&this.delete(i))}}setPathData(t){let i=this;this._transformer.isEmpty()||(i=this._transformer.getTransformData(this.getBounds(),this));for(let e=0;e<i.length;e++)switch(i.get(e).pointKind){case EPathPointKind.BEGIN:t.beginPath();break;case EPathPointKind.MOVETO:t.moveTo(i.get(e).point.x,i.get(e).point.y);break;case EPathPointKind.LINETO:t.lineTo(i.get(e).point.x,i.get(e).point.y);break;case EPathPointKind.CURVETO2:t.quadraticCurveTo(i.get(e).cPoint1.x,i.get(e).cPoint1.y,i.get(e).point.x,i.get(e).point.y);break;case EPathPointKind.CURVETO3:t.bezierCurveTo(i.get(e).cPoint1.x,i.get(e).cPoint1.y,i.get(e).cPoint2.x,i.get(e).cPoint2.y,i.get(e).point.x,i.get(e).point.y);break;case EPathPointKind.CLOSE:t.closePath()}}movePoint(t,i){for(var e=0;e<this.length;e++)this.get(e).pointKind!=EPathPointKind.BEGIN&&this.get(e).pointKind!=EPathPointKind.CLOSE&&(this.get(e).point.x=this.get(e).point.x+t,this.get(e).point.y=this.get(e).point.y+i,this.get(e).cPoint1.x=this.get(e).cPoint1.x+t,this.get(e).cPoint1.y=this.get(e).cPoint1.y+i,this.get(e).cPoint2.x=this.get(e).cPoint2.x+t,this.get(e).cPoint2.y=this.get(e).cPoint2.y+i)}scale(t,i){for(var e=0;e<this.length;e++)this.get(e).pointKind!=EPathPointKind.BEGIN&&this.get(e).pointKind!=EPathPointKind.CLOSE&&(this.get(e).point.x=this.get(e).point.x*t,this.get(e).point.y=this.get(e).point.y*i,this.get(e).cPoint1.x=this.get(e).cPoint1.x*t,this.get(e).cPoint1.y=this.get(e).cPoint1.y*i,this.get(e).cPoint2.x=this.get(e).cPoint2.x*t,this.get(e).cPoint2.y=this.get(e).cPoint2.y*i)}getBounds(){if(0==this.length)return new CRect;{let i=Number.MAX_VALUE,e=Number.MAX_VALUE,a=Number.MIN_VALUE,n=Number.MIN_VALUE;for(var t=0;t<this.length;t++)this.get(t).pointKind!=EPathPointKind.BEGIN&&this.get(t).pointKind!=EPathPointKind.CLOSE&&(0==t?(i=this.get(t).point.x,e=this.get(t).point.y,a=this.get(t).point.x,n=this.get(t).point.y):(this.get(t).point.x<i&&(i=this.get(t).point.x),this.get(t).point.y<e&&(e=this.get(t).point.y),this.get(t).point.x>a&&(a=this.get(t).point.x),this.get(t).point.y>n&&(n=this.get(t).point.y)),this.get(t).pointKind!=EPathPointKind.CURVETO2&&this.get(t).pointKind!=EPathPointKind.CURVETO3||(this.get(t).cPoint1.x<i&&(i=this.get(t).cPoint1.x),this.get(t).cPoint1.y<e&&(e=this.get(t).cPoint1.y),this.get(t).cPoint1.x>a&&(a=this.get(t).cPoint1.x),this.get(t).cPoint1.y>n&&(n=this.get(t).cPoint1.y)),this.get(t).pointKind==EPathPointKind.CURVETO3&&(this.get(t).cPoint2.x<i&&(i=this.get(t).cPoint2.x),this.get(t).cPoint2.y<e&&(e=this.get(t).cPoint2.y),this.get(t).cPoint2.x>a&&(a=this.get(t).cPoint2.x),this.get(t).cPoint2.y>n&&(n=this.get(t).cPoint2.y)));return new CRect(i,e,a,n)}}stretch(t){let i;i=this.width>0&&this.height>0?new CRect(0,0,this.width,this.height):this.getBounds();let e=t.width/i.width,a=t.height/i.height;this.width>0&&this.height>0||this.movePoint(-i.left,-i.top),this.scale(e,a),this.movePoint(t.left,t.top),this.doChange("set")}stretchIgnoreSize(t){let i=this.getBounds(),e=t.width/i.width,a=t.height/i.height;this.movePoint(-i.left,-i.top),this.scale(e,a),this.movePoint(t.left,t.top),this.doChange("set")}fit(t){let i;i=this.width>0&&this.height>0?new CRect(0,0,this.width,this.height):this.getBounds();let e=t.getFitRect(i,!0);e.left=e.left+t.left,e.right=e.right+t.left,e.top=e.top+t.top,e.bottom=e.bottom+t.top,this.stretch(e),this.doChange("set")}fitIgnoreSize(t){let i=this.getBounds(),e=t.getFitRect(i,!0);e.left=e.left+t.left,e.right=e.right+t.left,e.top=e.top+t.top,e.bottom=e.bottom+t.top,this.stretchIgnoreSize(e),this.doChange("set")}copyTo(){let t=new CPathPointList;for(var i=0;i<this.length;i++)t.add(this.get(i).copyTo());return t.width=this.width,t.height=this.height,t}referenceCopyTo(){let t=new CPathPointList;for(var i=0;i<this.length;i++)t.add(this.get(i));return t.width=this.width,t.height=this.height,t}stretchTo(t){let i=this.copyTo();return i.stretch(t),i}fitTo(t){let i=this.copyTo();return i.fit(t),i}copyFrom(t){this.clear();for(var i=0;i<t.length;i++){let e=new CPathPoint(EPathPointKind.BEGIN,0,0);e.copyFrom(t.get(i)),this.set(i,e);let a=this;e.onChange=function(){a.doChange("point")}}this.width=t.width,this.height=t.height}rotate(t,i){for(let e=0;e<this.length;e++){let a=this.get(e),n=CPoint.getDistancePoints(t,a.point.toPoint()),o=CPoint.getAngleFromTwoPoint(t,a.point.toPoint()),s=CPoint.getAngleToPoint(t,n,n,o+i);a.point.x=s.x,a.point.y=s.y,n=CPoint.getDistancePoints(t,a.cPoint1.toPoint()),o=CPoint.getAngleFromTwoPoint(t,a.cPoint1.toPoint()),s=CPoint.getAngleToPoint(t,n,n,o+i),a.cPoint1.x=s.x,a.cPoint1.y=s.y,n=CPoint.getDistancePoints(t,a.cPoint2.toPoint()),o=CPoint.getAngleFromTwoPoint(t,a.cPoint2.toPoint()),s=CPoint.getAngleToPoint(t,n,n,o+i),a.cPoint2.x=s.x,a.cPoint2.y=s.y}}toString(){let t="";for(let i=0;i<this.length;i++){let e=this.get(i);switch(0!=i&&(t+="\n"),e.pointKind){case EPathPointKind.BEGIN:t+="b";break;case EPathPointKind.CLOSE:t+="z";break;case EPathPointKind.CURVETO2:case EPathPointKind.CURVETO3:t+="c";break;case EPathPointKind.LINETO:t+="l";break;case EPathPointKind.MOVETO:t+="m"}t+=e.cPoint1.x+","+e.cPoint1.y,t+=" "+e.cPoint2.x+","+e.cPoint2.y,t+=" "+e.point.x+","+e.point.y}return t}fromFontPathData(t){this.clear();let i=t.split("\n");for(let t=0;t<i.length;t++)if(""!=i[t]){let e=i[t].substring(0,1);if("M"==e){let e=i[t].substring(1).split(","),a=new CPathPoint(EPathPointKind.MOVETO,parseFloat(e[0]),parseFloat(e[1]));this.add(a)}else if("L"==e){let e=i[t].substring(1).split(","),a=new CPathPoint(EPathPointKind.LINETO,parseFloat(e[0]),parseFloat(e[1]));this.add(a)}else if("C"==e){let e=i[t].split(" "),a=e[0].substring(1).split(","),n=e[1].split(","),o=e[2].split(","),s=new CPathPoint(EPathPointKind.CURVETO3,parseFloat(o[0]),parseFloat(o[1]));s.cPoint1.x=parseFloat(a[0]),s.cPoint1.y=parseFloat(a[1]),s.cPoint2.x=parseFloat(n[0]),s.cPoint2.y=parseFloat(n[1]),this.add(s)}else if("Q"==e){let e=i[t].split(" "),a=e[0].substring(1).split(","),n=e[1].split(","),o=new CPathPoint(EPathPointKind.CURVETO2,parseFloat(n[0]),parseFloat(n[1]));o.cPoint1.x=parseFloat(a[0]),o.cPoint1.y=parseFloat(a[1]),this.add(o)}else"Z"==e&&this.addPointClose()}}makeRectData(t=!1){return this.clear(),this.addPointMoveTo(CPoint.create(0,0)),this.addPointLineTo(CPoint.create(1,0)),this.addPointLineTo(CPoint.create(1,1)),this.addPointLineTo(CPoint.create(0,1)),this.addPointLineTo(CPoint.create(0,0)),t&&this.addPointClose,this}makeRoundRectData(t,i,e,a,n,o,s,h,r){let C;C=null==s?new CStringSet:s,r&&(this.clear(),this.add(CPathPoint.create(EPathPointKind.BEGIN,CPoint.create(t,i),CPoint.create(t,i),CPoint.create(t,i)))),C.has("leftTop")||0==n||0==o?this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t,i),CPoint.create(t,i),CPoint.create(t,i))):(this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t,i+o),CPoint.create(t,i),CPoint.create(t,i))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t+n,i),CPoint.create(t,i+(1-CON_ELLIPSE_CURVE_LENGTH)*o),CPoint.create(t+(1-CON_ELLIPSE_CURVE_LENGTH)*n,i)))),C.has("rightTop")||0==n||0==o?h.has("top")?this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t+e,i),CPoint.create(t,i),CPoint.create(t,i))):this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t+e,i),CPoint.create(t,i),CPoint.create(t,i))):h.has("top")?(this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t+e-n,i),CPoint.create(t,i),CPoint.create(t,i))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t+e,i+o),CPoint.create(t+e-(1-CON_ELLIPSE_CURVE_LENGTH)*n,i),CPoint.create(t+e,i+(1-CON_ELLIPSE_CURVE_LENGTH)*o)))):(this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t+e-n,i),CPoint.create(t,i),CPoint.create(t,i))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t+e,i+o),CPoint.create(t+e-(1-CON_ELLIPSE_CURVE_LENGTH)*n,i),CPoint.create(t+e,i+(1-CON_ELLIPSE_CURVE_LENGTH)*o)))),C.has("rightBottom")||0==n||0==o?h.has("right")?this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t+e,i+a),CPoint.create(t,i),CPoint.create(t,i))):this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t+e,i+a),CPoint.create(t,i),CPoint.create(t,i))):h.has("right")?(this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t+e,i+a-o),CPoint.create(t,i),CPoint.create(t,i))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t+e-n,i+a),CPoint.create(t+e,i+a-(1-CON_ELLIPSE_CURVE_LENGTH)*o),CPoint.create(t+e-(1-CON_ELLIPSE_CURVE_LENGTH)*n,i+a)))):(this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t+e,i+a-o),CPoint.create(t,i),CPoint.create(t,i))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t+e-n,i+a),CPoint.create(t+e,i+a-(1-CON_ELLIPSE_CURVE_LENGTH)*o),CPoint.create(t+e-(1-CON_ELLIPSE_CURVE_LENGTH)*n,i+a)))),C.has("leftBottom")||0==n||0==o?h.has("bottom")?this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t,i+a),CPoint.create(t,i),CPoint.create(t,i))):this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t,i+a),CPoint.create(t,i),CPoint.create(t,i))):h.has("bottom")?(this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t+n,i+a),CPoint.create(t,i),CPoint.create(t,i))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t,i+a-o),CPoint.create(t+(1-CON_ELLIPSE_CURVE_LENGTH)*n,i+a),CPoint.create(t,i+a-(1-CON_ELLIPSE_CURVE_LENGTH)*o)))):(this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t+n,i+a),CPoint.create(t,i),CPoint.create(t,i))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t,i+a-o),CPoint.create(t+(1-CON_ELLIPSE_CURVE_LENGTH)*n,i+a),CPoint.create(t,i+a-(1-CON_ELLIPSE_CURVE_LENGTH)*o)))),h.has("left")||(C.has("leftTop")||0==n||0==o?this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t,i),CPoint.create(t,i),CPoint.create(t,i))):this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t,i+o),CPoint.create(t,i),CPoint.create(t,i))),this.add(CPathPoint.create(EPathPointKind.CLOSE,CPoint.create(t,i),CPoint.create(t,i),CPoint.create(t,i))))}makeEllipseData(t,i,e,a,n=!0){function o(t,i){return CPoint.create(t,i)}n&&(this.clear(),this.add(CPathPoint.create(EPathPointKind.BEGIN,o(t,i),o(t,i),o(t,i)))),this.add(CPathPoint.create(EPathPointKind.MOVETO,o(t,i+a/2),o(t,i),o(t,i))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,o(t+e/2,i),o(t,i+a/2*(1-CON_ELLIPSE_CURVE_LENGTH)),o(t+e/2*(1-CON_ELLIPSE_CURVE_LENGTH),i))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,o(t+e,i+a/2),o(t+e/2+e/2*CON_ELLIPSE_CURVE_LENGTH,i),o(t+e,i+a/2*(1-CON_ELLIPSE_CURVE_LENGTH)))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,o(t+e/2,i+a),o(t+e,i+a/2+a/2*CON_ELLIPSE_CURVE_LENGTH),o(t+e/2+e/2*CON_ELLIPSE_CURVE_LENGTH,i+a))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,o(t,i+a/2),o(t+e/2*(1-CON_ELLIPSE_CURVE_LENGTH),i+a),o(t,i+a/2+a/2*CON_ELLIPSE_CURVE_LENGTH))),this.add(CPathPoint.create(EPathPointKind.CLOSE,o(t,i),o(t,i),o(t,i)))}makePoligonData(t,i=!1,e){this.clear();let a=CPoint.getPoligonPoints(t,!0,e);for(let t=0;t<a.length;t++)0==t?this.addPointMoveTo(a.get(t)):this.addPointLineTo(a.get(t));return i&&this.addPointClose(),this}makePoligonRoundData(t,i,e=!1,a){this.clear();let n=CPoint.getPoligonPoints(t,!0,a);for(let t=0;t<n.length;t++)if(0==t){let e=CPoint.getLineMiddlePoint(n.get(n.length-2),n.get(n.length-1),i);this.addPointMoveTo(e);let a=new CPoint(0,0);if(t+1<n.length){a=CPoint.getLineMiddlePoint(n.get(0),n.get(1),1-i);let t=this.getCurvePoint(e,n.get(0),a);this.addPointCurveTo3(a,t.ptCurve1,t.ptCurve2)}}else{let e=n[t],a=new CPoint(0,0),o=CPoint.getLineMiddlePoint(n.get(t-1),e,i);if(this.addPointLineTo(o),t+1<n.length){a=CPoint.getLineMiddlePoint(e,n.get(t+1),1-i);let s=this.getCurvePoint(o,e,a);this.addPointCurveTo3(a,s.ptCurve1,s.ptCurve2)}}return e&&this.addPointClose(),this}makeHornData(t,i,e=!1,a){this.clear();let n=CPoint.getHornPoints(t,i,!0,a);for(let t=0;t<n.length;t++)0==t?this.addPointMoveTo(n.get(t)):this.addPointLineTo(n.get(t));return e&&this.addPointClose(),this}makeHornRoundData(t,i,e,a=!0,n=!1,o){this.clear();let s=CPoint.getHornPoints(t,i,!0,o);for(let t=0;t<s.length;t++)if(0==t){let i=CPoint.getLineMiddlePoint(s[s.length-2],s[s.length-1],e);this.addPointMoveTo(i);let a=new CPoint(0,0);if(t+1<s.length){a=CPoint.getLineMiddlePoint(s[0],s[1],1-e);let t=this.getCurvePoint(i,s[0],a);this.addPointCurveTo3(a,t.ptCurve1,t.ptCurve2)}}else if(a)if(t%2==0){let i=s[t],a=new CPoint(0,0),n=CPoint.getLineMiddlePoint(s[t-1],i,e);if(this.addPointLineTo(n),t+1<s.length){a=CPoint.getLineMiddlePoint(i,s[t+1],1-e);let o=this.getCurvePoint(n,i,a);this.addPointCurveTo3(a,o.ptCurve1,o.ptCurve2)}}else this.addPointLineTo(s[t]);else{let i=s[t],a=new CPoint(0,0),n=CPoint.getLineMiddlePoint(s[t-1],i,e);if(this.addPointLineTo(n),t+1<s.length){a=CPoint.getLineMiddlePoint(i,s[t+1],1-e);let o=this.getCurvePoint(n,i,a);this.addPointCurveTo3(a,o.ptCurve1,o.ptCurve2)}}return n&&this.addPointClose(),this}makeArcData(t,i,e){this.clear();let a=i,n=e,o=CPoint.getAngleToPoint(t,.5,.5,a);if(this.addPointMoveTo(o),e>0){for(;n>90;){let i=CPoint.getAngleToPoint(t,.5,.5,a+90),e=CON_ELLIPSE_CURVE_LENGTH,s=CPoint.getAngleToPoint(o,.5*e,.5*e,90,CPoint.getAngleFromTwoPoint(t,o)),h=CPoint.getAngleToPoint(i,.5*e,.5*e,-90,CPoint.getAngleFromTwoPoint(t,i));this.addPointCurveTo3(i,s,h),o.copyFrom(i),a+=90,n-=90}let i=CPoint.getAngleToPoint(t,.5,.5,a+n),e=CCalc.cr(CON_ELLIPSE_CURVE_LENGTH,0,90,n,2),s=CPoint.getAngleToPoint(o,.5*e,.5*e,90,CPoint.getAngleFromTwoPoint(t,o)),h=CPoint.getAngleToPoint(i,.5*e,.5*e,-90,CPoint.getAngleFromTwoPoint(t,i));this.addPointCurveTo3(i,s,h)}else{for(;n<-90;){let i=CPoint.getAngleToPoint(t,.5,.5,a-90),e=CON_ELLIPSE_CURVE_LENGTH,s=CPoint.getAngleToPoint(o,.5*e,.5*e,-90,CPoint.getAngleFromTwoPoint(t,o)),h=CPoint.getAngleToPoint(i,.5*e,.5*e,90,CPoint.getAngleFromTwoPoint(t,i));this.addPointCurveTo3(i,s,h),o.copyFrom(i),a-=90,n+=90}let i=CPoint.getAngleToPoint(t,.5,.5,a+n),e=CCalc.cr(CON_ELLIPSE_CURVE_LENGTH,0,90,Math.abs(n),2),s=CPoint.getAngleToPoint(o,.5*e,.5*e,-90,CPoint.getAngleFromTwoPoint(t,o)),h=CPoint.getAngleToPoint(i,.5*e,.5*e,90,CPoint.getAngleFromTwoPoint(t,i));this.addPointCurveTo3(i,s,h)}return this}twoLineToCurve(t,i){if(t-1<0||t+1>this.length-1||this[t].pointKind!=EPathPointKind.LINETO||this[t+1].pointKind!=EPathPointKind.LINETO)return;let e=this.getTwoLineCurvePoint(this[t-1].point,this[t].point,this[t+1].point,i);this[t].point.copyFrom(e.pt1Stop),this.insert(t+1,CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(e.pt2Start.x,e.pt2Start.y),CPoint.create(e.ptCurve1.x,e.ptCurve1.y),CPoint.create(e.ptCurve2.x,e.ptCurve2.y)))}getTwoLineCurvePoint(t,i,e,a){let n=CPoint.getLineMiddlePoint(t,i,a),o=CPoint.getLineMiddlePoint(i,e,1-a);return{pt1Start:t,pt1Stop:n,ptCurve1:CPoint.getLineMiddlePoint(n,i,CON_ELLIPSE_CURVE_LENGTH),ptCurve2:CPoint.getLineMiddlePoint(i,o,1-CON_ELLIPSE_CURVE_LENGTH),pt2Start:o,pt2Stop:e}}getCurvePoint(t,i,e){return{ptStart:t,ptCurve1:CPoint.getLineMiddlePoint(t,i,CON_ELLIPSE_CURVE_LENGTH),ptCurve2:CPoint.getLineMiddlePoint(i,e,1-CON_ELLIPSE_CURVE_LENGTH),ptStop:e}}addPointList(t){for(let i=0;i<t.length;i++){let e=t.get(i).copyTo();this.add(e)}}invertX(){let t=this.getBounds(),i=t.left+t.width/2;for(let t=0;t<this.length;t++)this.get(t).point.x+=2*(i-this.get(t).point.x),this.get(t).cPoint1.x+=2*(i-this.get(t).cPoint1.x),this.get(t).cPoint2.x+=2*(i-this.get(t).cPoint2.x)}invertY(){let t=this.getBounds(),i=t.top+t.height/2;for(let t=0;t<this.length;t++)this.get(t).point.y+=2*(i-this.get(t).point.y),this.get(t).cPoint1.y+=2*(i-this.get(t).cPoint1.y),this.get(t).cPoint2.y+=2*(i-this.get(t).cPoint2.y)}invert(){this.invertX(),this.invertY()}lineToCurve(){for(let t=0;t<this.length;t++)if(this.get(t).pointKind==EPathPointKind.LINETO&&t>0&&(this.get(t-1).pointKind==EPathPointKind.MOVETO||this.get(t-1).pointKind==EPathPointKind.LINETO||this.get(t-1).pointKind==EPathPointKind.CURVETO2||this.get(t-1).pointKind==EPathPointKind.CURVETO3)){let i=this.get(t-1).point;this.get(t).pointKind=EPathPointKind.CURVETO3;let e=CPoint.getLineMiddlePoint(i.toPoint(),this.get(t).point.toPoint(),1/3);this.get(t).cPoint1.x=e.x,this.get(t).cPoint1.y=e.y,e=CPoint.getLineMiddlePoint(i.toPoint(),this.get(t).point.toPoint(),1/3*2),this.get(t).cPoint2.x=e.x,this.get(t).cPoint2.y=e.y}}getSplitLine(t){let i=new CPathPointList;for(let e=0;e<this.length;e++)if(this.get(e).pointKind==EPathPointKind.LINETO||this.get(e).pointKind==EPathPointKind.CURVETO2||this.get(e).pointKind==EPathPointKind.CURVETO3&&e>0){if(this.get(e-1).pointKind==EPathPointKind.MOVETO||this.get(e-1).pointKind==EPathPointKind.LINETO||this.get(e-1).pointKind==EPathPointKind.CURVETO2||this.get(e-1).pointKind==EPathPointKind.CURVETO3){if(this.get(e).pointKind==EPathPointKind.LINETO){let a=CPoint.splitLinePoints(this.get(e-1).point.toPoint(),this.get(e).point.toPoint(),t);for(let t=0;t<a.length;t++)i.addPointLineTo(a[t])}if(this.get(e).pointKind==EPathPointKind.CURVETO2){let a=CPoint.splitCurve2LinePoints(this.get(e-1).point.toPoint(),this.get(e).cPoint1.toPoint(),this.get(e).point.toPoint(),t);for(let t=0;t<a.length;t++)i.addPointLineTo(a[t])}if(this.get(e).pointKind==EPathPointKind.CURVETO3){let a=CPoint.splitCurveLinePoints(this.get(e-1).point.toPoint(),this.get(e).cPoint1.toPoint(),this.get(e).cPoint2.toPoint(),this.get(e).point.toPoint(),t);for(let t=0;t<a.length;t++)i.addPointLineTo(a[t])}}}else i.add(this.get(e).copyTo());return i}splitLine(t){let i=this.getSplitLine(t);this.copyFrom(i)}}class CFont extends CNotifyChangeKindObject{constructor(){super(...arguments),this._fontStyle="normal",this._fontVariant="normal",this._fontWeight="normal",this._fontSize=12,this._fontFamily="Arial"}static get CON_CHANGE_STYLE(){return"s"}static get CON_CHANGE_VARIANT(){return"v"}static get CON_CHANGE_WEIGHT(){return"w"}static get CON_CHANGE_SIZE(){return"si"}static get CON_CHANGE_FAMILY(){return"f"}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!=t&&(this._fontStyle=t,this.doChange(CFont.CON_CHANGE_STYLE))}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!=t&&(this._fontVariant=t,this.doChange(CFont.CON_CHANGE_VARIANT))}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!=t&&(this._fontWeight=t,this.doChange(CFont.CON_CHANGE_WEIGHT))}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!=t&&(this._fontSize=t,this.doChange(CFont.CON_CHANGE_SIZE))}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!=t&&(this._fontFamily=t,this.doChange(CFont.CON_CHANGE_FAMILY))}doToData(t){super.doToData(t),CDataClass.putData(t,"fontStyle",this.fontStyle,"normal"),CDataClass.putData(t,"fontVariant",this.fontVariant,"normal"),CDataClass.putData(t,"fontWeight",this.fontWeight,"normal"),CDataClass.putData(t,"fontSize",this.fontSize,12),CDataClass.putData(t,"fontFamily",this.fontFamily,"Arial")}doFromData(t){super.doFromData(t),this.fontStyle=CDataClass.getData(t,"fontStyle","normal"),this.fontVariant=CDataClass.getData(t,"fontVariant","normal"),this.fontWeight=CDataClass.getData(t,"fontWeight","normal"),this.fontSize=CDataClass.getData(t,"fontSize",12),this.fontFamily=CDataClass.getData(t,"fontFamily","Arial")}setFont(t){t.font=this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily}}!function(t){t[t.HEAD=0]="HEAD",t[t.CENTER=1]="CENTER",t[t.TAIL=2]="TAIL"}(ETextAlign||(ETextAlign={}));class CCustomTextSet extends CFont{constructor(){super(),this._hAlign=ETextAlign.CENTER,this._vAlign=ETextAlign.CENTER,this._margins=new CNotifyRect(0,0,0,0);let t=this;this._margins.onChange=function(){t.doChange(CCustomTextSet.CON_CHANGE_MARGINS)}}static get CON_CHANGE_H_ALIGN(){return"h"}static get CON_CHANGE_V_ALIGN(){return"v"}static get CON_CHANGE_MARGINS(){return"m"}get margins(){return this._margins}get hAlign(){return this._hAlign}set hAlign(t){this._hAlign!=t&&(this._hAlign=t,this.doChange(CCustomTextSet.CON_CHANGE_H_ALIGN))}get vAlign(){return this._vAlign}set vAlign(t){this._vAlign!=t&&(this._vAlign=t,this.doChange(CCustomTextSet.CON_CHANGE_V_ALIGN))}doToData(t){super.doToData(t),CDataClass.putData(t,"hAlign",this.hAlign,ETextAlign.CENTER),CDataClass.putData(t,"vAlign",this.vAlign,ETextAlign.CENTER),CDataClass.putData(t,"margins",this.margins.toData(),{},!0)}doFromData(t){super.doFromData(t),this.hAlign=CDataClass.getData(t,"hAlign",ETextAlign.CENTER),this.vAlign=CDataClass.getData(t,"vAlign",ETextAlign.CENTER),this.margins.fromData(CDataClass.getData(t,"margins",{},!0))}getTextPoint(t,i){let e=0,a=0;switch(this.hAlign){case ETextAlign.HEAD:t.textAlign="left",e=i.left+this._margins.left;break;case ETextAlign.CENTER:t.textAlign="center",e=i.left+i.width/2;break;case ETextAlign.TAIL:t.textAlign="right",e=i.right-this._margins.right}switch(this.vAlign){case ETextAlign.HEAD:a=i.top+this._margins.top+this._fontSize;break;case ETextAlign.CENTER:a=i.top+i.height/2+this._fontSize/3;break;case ETextAlign.TAIL:a=i.bottom-this._margins.bottom}return new CPoint(e,a)}}class CTextSet extends CCustomTextSet{constructor(){super(),this._enabled=!0,this._fill=new CFillSet,this._stroke=new CStrokeSet,this._languageKey="";let t=this;this._fill.styleKind=EStyleKind.SOLID,this._fill.solidColor="#000000",this._fill.onChange=function(){t.doChange(CTextSet.CON_CHANGE_FILL)},this._stroke.onChange=function(){t.doChange(CTextSet.CON_CHANGE_STROKE)}}static get CON_CHANGE_ENABLED(){return"e"}static get CON_CHANGE_FILL(){return"fill"}static get CON_CHANGE_STROKE(){return"stroke"}static get CON_CHANGE_LANGUAGE_KEY(){return"lk"}get fill(){return this._fill}get stroke(){return this._stroke}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get languageKey(){return this._languageKey}set languageKey(t){this._languageKey!=t&&(this._languageKey=t,this.doChange(CTextSet.CON_CHANGE_LANGUAGE_KEY))}doToData(t){super.doToData(t),CDataClass.putData(t,"enabled",this.enabled,!0),CDataClass.putData(t,"fill",this.fill.toData(),{styleKind:1,solidColor:"#000000"},!0),CDataClass.putData(t,"stroke",this.stroke.toData(),{},!0)}doFromData(t){super.doFromData(t),this.enabled=CDataClass.getData(t,"enabled",!0),this.fill.fromData(CDataClass.getData(t,"fill",{styleKind:1,solidColor:"#000000"},!0)),this.stroke.fromData(CDataClass.getData(t,"stroke",{},!0))}drawText(t,i,e,a){if(!this._enabled||0==i.width||0==i.height)return;let n=a;if(null!=n){n.canvas.width=i.width,n.canvas.height=i.height,n.font=this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.fill.setContext(n,i),this.stroke.setContext(n,i);let a=this.getTextPoint(n,new CRect(0,0,i.width,i.height));if(e.indexOf("\n")>=0){let t=e.split("\n"),i=a.y-t.length*this.fontSize/2+.5*this.fontSize;for(let e=0;e<t.length;e++)this.fill.styleKind!=EStyleKind.EMPTY&&n.fillText(t[e],a.x,i),this.stroke.styleKind!=EStyleKind.EMPTY&&n.strokeText(t[e],a.x,i),i+=this.fontSize}else this.fill.styleKind!=EStyleKind.EMPTY&&n.fillText(e,a.x,a.y),this.stroke.styleKind!=EStyleKind.EMPTY&&n.strokeText(e,a.x,a.y);t.drawImage(n.canvas,i.left,i.top,i.width,i.height)}else{t.font=this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.fill.setContext(t,i),this.stroke.setContext(t,i);let a=this.getTextPoint(t,i);if(e.indexOf("\n")>=0){let i=e.split("\n"),n=a.y-i.length*this.fontSize/2+.5*this.fontSize;for(let e=0;e<i.length;e++)this.fill.styleKind!=EStyleKind.EMPTY&&t.fillText(i[e],a.x,n),this.stroke.styleKind!=EStyleKind.EMPTY&&t.strokeText(i[e],a.x,n),n+=this.fontSize}else this.fill.styleKind!=EStyleKind.EMPTY&&t.fillText(e,a.x,a.y),this.stroke.styleKind!=EStyleKind.EMPTY&&t.strokeText(e,a.x,a.y)}}static create(t,i=ETextAlign.CENTER,e=ETextAlign.CENTER,a=12){let n=new CTextSet;return n.fill.solidColor=t,n.hAlign=i,n.vAlign=e,n.fontSize=a,n.margins.all=5,n}}class CGradientPoint extends CNotifyChangeKindObject{constructor(t,i){super(),this._offset=0,this._color="rgba(255,255,255,1)",this._offset=t,this._color=i}static get CON_CHANGE_OFFSET(){return"o"}static get CON_CHANGE_COLOR(){return"c"}get offset(){return this._offset}set offset(t){this._offset!=t&&(this._offset=t,this.doChange(CGradientPoint.CON_CHANGE_OFFSET))}get color(){return this._color}set color(t){this._color!=t&&(this._color=t,this.doChange(CGradientPoint.CON_CHANGE_COLOR))}doToData(t){super.doToData(t),CDataClass.putData(t,"offset",this.offset,0),CDataClass.putData(t,"color",this.color,"rgba(255,255,255,1)")}doFromData(t){super.doFromData(t),this.offset=CDataClass.getData(t,"offset",0),this.color=CDataClass.getData(t,"color","rgba(255,255,255,1)")}static create(t,i){return new CGradientPoint(t,i)}}class CGradientPointList extends CList{addPoint(t,i){let e=CGradientPoint.create(t,i),a=this;e.onChange=function(){a.doChange("point")},this.add(e)}insertPoint(t,i,e){let a=CGradientPoint.create(i,e),n=this;a.onChange=function(){n.doChange("point")},this.insert(t,a)}doToData(t){super.doToData(t);for(let i=0;i<this.length;i++)t.push(this.get(i).toData())}doFromData(t){this.clear();let i=this;for(let e=0;e<t.length;e++){let a=new CGradientPoint(0,"");a.fromData(t[e]),a.onChange=function(){i.doChange("point")},this.add(a)}}}!function(t){t[t.LINEAR=0]="LINEAR",t[t.RADIAL=1]="RADIAL"}(EGradientKind||(EGradientKind={}));class CGradient extends CNotifyChangeKindObject{constructor(){super(),this._gradientKind=EGradientKind.LINEAR,this._startPoint=new CNotifyPoint(0,0),this._stopPoint=new CNotifyPoint(0,1),this._pointList=new CGradientPointList,this._startRadius=0,this._stopRadius=360;let t=this;this._pointList.onChange=function(i,e){t.doChange(CGradient.CON_CHANGE_POINT_LIST)},this._startPoint.onChange=function(i,e){t.doChange(CGradient.CON_CHANGE_START_POINT)},this._stopPoint.onChange=function(i,e){t.doChange(CGradient.CON_CHANGE_STOP_POINT)}}static get CON_CHANGE_GRADIENT_KIND(){return"g"}static get CON_CHANGE_START_POINT(){return"sp"}static get CON_CHANGE_STOP_POINT(){return"stp"}static get CON_CHANGE_POINT_LIST(){return"pl"}static get CON_CHANGE_START_RADIUS(){return"sr"}static get CON_CHANGE_STOP_RADIUS(){return"str"}get pointList(){return this._pointList}get gradientKind(){return this._gradientKind}set gradientKind(t){this._gradientKind!=t&&(this._gradientKind=t,this.doChange(CGradient.CON_CHANGE_GRADIENT_KIND))}get startPoint(){return this._startPoint}set startPoint(t){if(this._startPoint!=t){let i=this;this._startPoint=t,this._startPoint.onChange=function(t,e){i.doChange(CGradient.CON_CHANGE_START_POINT)},this.doChange(CGradient.CON_CHANGE_START_POINT)}}get stopPoint(){return this._stopPoint}set stopPoint(t){if(this._stopPoint!=t){let i=this;this._stopPoint=t,this._stopPoint.onChange=function(t,e){i.doChange(CGradient.CON_CHANGE_STOP_POINT)},this.doChange(CGradient.CON_CHANGE_STOP_POINT)}}get startRadius(){return this._startRadius}set startRadius(t){this._startRadius!=t&&(this._startRadius=t,this.doChange(CGradient.CON_CHANGE_START_RADIUS))}get stopRadius(){return this._stopRadius}set stopRadius(t){this._stopRadius!=t&&(this._stopRadius=t,this.doChange(CGradient.CON_CHANGE_STOP_RADIUS))}doToData(t){super.doToData(t),CDataClass.putData(t,"gradientKind",this.gradientKind,EGradientKind.LINEAR),CDataClass.putData(t,"startPoint",this.startPoint.toData(),{},!0),CDataClass.putData(t,"stopPoint",this.stopPoint.toData(),{y:1},!0),CDataClass.putData(t,"pointList",this.pointList.toData(),[],!0),CDataClass.putData(t,"startRadius",this.startRadius,0),CDataClass.putData(t,"stopRadius",this.stopRadius,360)}doFromData(t){super.doFromData(t),this.gradientKind=CDataClass.getData(t,"gradientKind",EGradientKind.LINEAR),this.startPoint.fromData(CDataClass.getData(t,"startPoint",{},!0)),this.stopPoint.fromData(CDataClass.getData(t,"stopPoint",{y:1},!0)),this.pointList.fromData(CDataClass.getData(t,"pointList",[],!0)),this.startRadius=CDataClass.getData(t,"startRadius",0),this.stopRadius=CDataClass.getData(t,"stopRadius",360)}getGradient(t,i){let e,a=i.left+this._startPoint.x*i.width,n=i.top+this._startPoint.y*i.height,o=i.left+this._stopPoint.x*i.width,s=i.top+this._stopPoint.y*i.height;if(!(isNaN(a)||isNaN(n)||isNaN(o)||isNaN(s))){e=this._gradientKind==EGradientKind.LINEAR?t.createLinearGradient(i.left+this._startPoint.x*i.width,i.top+this._startPoint.y*i.height,i.left+this._stopPoint.x*i.width,i.top+this._stopPoint.y*i.height):t.createRadialGradient(i.left+this._startPoint.x*i.width,i.top+this._startPoint.y*i.height,this._startRadius,i.left+this._stopPoint.x*i.width,i.top+this._stopPoint.y*i.height,this._stopRadius);for(var h=0;h<this._pointList.length;h++)e.addColorStop(this._pointList.get(h).offset,this._pointList.get(h).color);return e}}}!function(t){t[t.EMPTY=0]="EMPTY",t[t.SOLID=1]="SOLID",t[t.GRADIENT=2]="GRADIENT"}(EStyleKind||(EStyleKind={}));class CFillSet extends CGradient{constructor(){super(...arguments),this._styleKind=EStyleKind.EMPTY,this._solidColor="rgba(255,255,255,1)"}static get CON_CHANGE_STYLE_KIND(){return"styleKind"}static get CON_CHANGE_SOLID_COLOR(){return"solidColor"}get styleKind(){return this._styleKind}set styleKind(t){t!=this._styleKind&&(this._styleKind=t,this.doChange(CFillSet.CON_CHANGE_STYLE_KIND))}get solidColor(){return this._solidColor}set solidColor(t){t!=this._solidColor&&(this._solidColor=t,this.doChange(CFillSet.CON_CHANGE_SOLID_COLOR))}doToData(t){super.doToData(t),CDataClass.putData(t,"styleKind",this.styleKind,EStyleKind.EMPTY),CDataClass.putData(t,"solidColor",this.solidColor,"rgba(255,255,255,1)")}doFromData(t){super.doFromData(t),this.styleKind=CDataClass.getData(t,"styleKind",EStyleKind.EMPTY),this.solidColor=CDataClass.getData(t,"solidColor","rgba(255,255,255,1)")}setContext(t,i){switch(this.styleKind){case EStyleKind.SOLID:t.fillStyle=this.solidColor;break;case EStyleKind.GRADIENT:let e=this.getGradient(t,i);null!=e&&(t.fillStyle=e)}}}!function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(EStrokeLineCap||(EStrokeLineCap={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(EStrokeLineJoin||(EStrokeLineJoin={}));class CStrokeSet extends CFillSet{constructor(){super(...arguments),this.__lineDash=[],this._lineWidth=0,this._lineCap=EStrokeLineCap.ROUND,this._lineJoin=EStrokeLineJoin.ROUND,this._lineDash=""}static get CON_CHANGE_LINE_WIDTH(){return"lineWidth"}static get CON_CHANGE_LINE_CAP(){return"lineCap"}static get CON_CHANGE_LINE_JOIN(){return"lineJoin"}static get CON_CHANGE_LINE_DASH(){return"lineDash"}get lineWidth(){return this._lineWidth}set lineWidth(t){t!=this._lineWidth&&(this._lineWidth=t,this.doChange(CStrokeSet.CON_CHANGE_LINE_WIDTH))}get lineCap(){return this._lineCap}set lineCap(t){t!=this._lineCap&&(this._lineCap=t,this.doChange(CStrokeSet.CON_CHANGE_LINE_CAP))}get lineJoin(){return this._lineJoin}set lineJoin(t){t!=this._lineJoin&&(this._lineJoin=t,this.doChange(CStrokeSet.CON_CHANGE_LINE_JOIN))}get lineDash(){return this._lineDash}set lineDash(t){if(t!=this._lineDash){if(this._lineDash=t,""!=t){let t=this._lineDash.split(",");this.__lineDash=[];for(let i=0;i<t.length;i++)this.__lineDash.push(parseFloat(t[i]))}this.doChange(CStrokeSet.CON_CHANGE_LINE_DASH)}}doToData(t){super.doToData(t),CDataClass.putData(t,"lineWidth",this.lineWidth,0),CDataClass.putData(t,"lineCap",this.lineCap,EStrokeLineCap.ROUND),CDataClass.putData(t,"lineJoin",this.lineJoin,EStrokeLineJoin.ROUND),CDataClass.putData(t,"lineDash",this.lineDash,"")}doFromData(t){super.doFromData(t),this.lineWidth=CDataClass.getData(t,"lineWidth",0),this.lineCap=CDataClass.getData(t,"lineCap",EStrokeLineCap.ROUND),this.lineJoin=CDataClass.getData(t,"lineJoin",EStrokeLineJoin.ROUND),this.lineDash=CDataClass.getData(t,"lineDash","")}setContext(t,i){switch(this.styleKind){case EStyleKind.SOLID:t.strokeStyle=this.solidColor;break;case EStyleKind.GRADIENT:let e=this.getGradient(t,i);null!=e&&(t.strokeStyle=e)}switch(t.lineWidth=this.lineWidth,this.lineCap){case EStrokeLineCap.BUTT:t.lineCap="butt";break;case EStrokeLineCap.ROUND:t.lineCap="round";break;case EStrokeLineCap.SQUARE:t.lineCap="square"}switch(this.lineJoin){case EStrokeLineJoin.BEVEL:t.lineJoin="bevel";break;case EStrokeLineJoin.MITER:t.lineJoin="miter";break;case EStrokeLineJoin.ROUND:t.lineJoin="round"}t.setLineDash(this.__lineDash)}}!function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.TOP=2]="TOP",t[t.RIGHT=3]="RIGHT",t[t.BOTTOM=4]="BOTTOM",t[t.CLIENT=5]="CLIENT",t[t.CENTER=6]="CENTER",t[t.LEFTTOP=7]="LEFTTOP",t[t.RIGHTTOP=8]="RIGHTTOP",t[t.LEFTBOTTOM=9]="LEFTBOTTOM",t[t.RIGHTBOTTOM=10]="RIGHTBOTTOM",t[t.MIDDLELEFT=11]="MIDDLELEFT",t[t.MIDDLETOP=12]="MIDDLETOP",t[t.MIDDLERIGHT=13]="MIDDLERIGHT",t[t.MIDDLEBOTTOM=14]="MIDDLEBOTTOM",t[t.HCENTER=15]="HCENTER",t[t.VCENTER=16]="VCENTER"}(ECanvasItemAlign||(ECanvasItemAlign={})),function(t){t[t.RECTANGLE=0]="RECTANGLE",t[t.ROUNDRECTANGLE=1]="ROUNDRECTANGLE",t[t.ELLIPSE=2]="ELLIPSE",t[t.ARC=3]="ARC",t[t.PATH=4]="PATH",t[t.TEXT=5]="TEXT",t[t.IMAGE=6]="IMAGE"}(ECanvasItemKind||(ECanvasItemKind={})),function(t){t[t.ALL=0]="ALL",t[t.CHECK_HEAD=1]="CHECK_HEAD",t[t.CHECK_TAIL=2]="CHECK_TAIL",t[t.COLUMN=3]="COLUMN",t[t.ROW=4]="ROW"}(EPatternKind||(EPatternKind={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.PATTERN=1]="PATTERN",t[t.ROTATE=2]="ROTATE",t[t.RANDOM=3]="RANDOM"}(EPaintKind||(EPaintKind={}));class CCanvasItem extends CNotifyChangeKindObject{constructor(){super(),this._align=ECanvasItemAlign.NONE,this._kind=ECanvasItemKind.RECTANGLE,this._name="",this._position=new CNotifyRect(0,0,0,0),this._positionUnit=EPositionUnit.PIXEL,this._rotationAngle=0,this._rotationCenterX=.5,this._rotationCenterY=.5,this._margins=new CNotifyRect(0,0,0,0),this._fill=new CFillSet,this._stroke=new CStrokeSet,this._opacity=1,this._composite="source-over",this._visible=!0,this._pathData=new CPathPointList,this._pathFitMode=EFitMode.STRETCH,this._radiusX=0,this._radiusY=0,this._disableRoundSet=new CStringSet,this._disableLineSet=new CStringSet,this._textSet=new CTextSet,this._text="",this._imageSrc="",this._imageFitMode=EFitMode.FIT,this._paintKind=EPaintKind.NORMAL,this._paintWidth=50,this._paintHeight=50,this._patternIgnoreCount=0,this._patternMargin=0,this._patternKind=EPatternKind.ALL,this._paintRotateCount=5,this._paintRotateStartAngle=-90,this._paintRotateStopAngle=270,this._paintRotateRadiusX=.5,this._paintRotateRadiusY=.5,this._paintRotateApplyAngle=!0,this._randomCount=10,this._randomWidthMin=10,this._randomWidthMax=100,this._randomHeightMin=10,this._randomHeightMax=100,this._filter="",this._shadowColor="",this._shadowBlur=0,this._shadowOffsetX=0,this._shadowOffsetY=0;let t=this;this._position.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_POSITION)},this._pathData.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_PATH_DATA)},this._fill.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_FILL)},this._stroke.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_STROKE)},this._disableRoundSet.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_DISABLE_ROUND_SET)},this._disableLineSet.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_DISABLE_LINE_SET)},this._textSet.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_TEXTSET)},this._margins.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_MARGINS)}}static get CON_CHANGE_ALIGN(){return"a"}static get CON_CHANGE_KIND(){return"k"}static get CON_CHANGE_NAME(){return"i"}static get CON_CHANGE_POSITION(){return"p"}static get CON_CHANGE_POSITION_UNIT(){return"pu"}static get CON_CHANGE_ROTATION_ANGLE(){return"ra"}static get CON_CHANGE_ROTATION_CENTER_X(){return"rx"}static get CON_CHANGE_ROTATION_CENTER_Y(){return"ry"}static get CON_CHANGE_MARGINS(){return"m"}static get CON_CHANGE_FILL(){return"f"}static get CON_CHANGE_STROKE(){return"s"}static get CON_CHANGE_OPACITY(){return"o"}static get CON_CHANGE_VISIBLE(){return"v"}static get CON_CHANGE_PATH_DATA(){return"pd"}static get CON_CHANGE_RADIUS_X(){return"rax"}static get CON_CHANGE_RADIUS_Y(){return"ray"}static get CON_CHANGE_DISABLE_ROUND_SET(){return"dr"}static get CON_CHANGE_DISABLE_LINE_SET(){return"dl"}static get CON_CHANGE_TEXTSET(){return"tx"}static get CON_CHANGE_TEXT(){return"t"}static get CON_CHANGE_FILTER(){return"fi"}static get CON_CHANGE_SHADOW_COLOR(){return"sc"}static get CON_CHANGE_SHADOW_BLUR(){return"sb"}static get CON_CHANGE_SHADOW_OFFSET_X(){return"sx"}static get CON_CHANGE_SHADOW_OFFSET_Y(){return"sy"}get align(){return this._align}set align(t){this._align!=t&&(this._align=t,this.doChange(CCanvasItem.CON_CHANGE_ALIGN))}get rotationAngle(){return this._rotationAngle}set rotationAngle(t){this._rotationAngle!=t&&(this._rotationAngle=t,this.doChange(CCanvasItem.CON_CHANGE_ROTATION_ANGLE))}get rotationCenterX(){return this._rotationCenterX}set rotationCenterX(t){this._rotationCenterX!=t&&(this._rotationCenterX=t,this.doChange(CCanvasItem.CON_CHANGE_ROTATION_CENTER_X))}get rotationCenterY(){return this._rotationCenterY}set rotationCenterY(t){this._rotationCenterY!=t&&(this._rotationCenterY=t,this.doChange(CCanvasItem.CON_CHANGE_ROTATION_CENTER_Y))}get positionUnit(){return this._positionUnit}set positionUnit(t){this._positionUnit!=t&&(this._positionUnit=t,this.doChange(CCanvasItem.CON_CHANGE_POSITION_UNIT))}get kind(){return this._kind}set kind(t){this._kind!=t&&(this._kind=t,this.doChange(CCanvasItem.CON_CHANGE_KIND))}get name(){return this._name}set name(t){this._name!=t&&(this._name=t,this.doChange(CCanvasItem.CON_CHANGE_NAME))}get position(){return this._position}set position(t){if(this._position!=t){this._position=t;let i=this;this._position.onChange=function(){i.doChange(CCanvasItem.CON_CHANGE_POSITION)},this.doChange(CCanvasItem.CON_CHANGE_POSITION)}}get margins(){return this._margins}get fill(){return this._fill}get stroke(){return this._stroke}get pathData(){return this._pathData}get textSet(){return this._textSet}get opacity(){return this._opacity}set opacity(t){this._opacity!=t&&(this._opacity=t,this.doChange(CCanvasItem.CON_CHANGE_OPACITY))}get visible(){return this._visible}set visible(t){this._visible!=t&&(this._visible=t,this.doChange(CCanvasItem.CON_CHANGE_VISIBLE))}get radiusX(){return this._radiusX}set radiusX(t){this._radiusX!=t&&(this._radiusX=t,this.doChange(CCanvasItem.CON_CHANGE_RADIUS_X))}get radiusY(){return this._radiusY}set radiusY(t){this._radiusY!=t&&(this._radiusY=t,this.doChange(CCanvasItem.CON_CHANGE_RADIUS_Y))}get disableRoundSet(){return this._disableRoundSet}get disableLineSet(){return this._disableLineSet}get text(){return this._text}set text(t){this._text!=t&&(this._text=t,this.doChange(CCanvasItem.CON_CHANGE_TEXT))}get imageSrc(){return this._imageSrc}set imageSrc(t){if(this._imageSrc!=t){this._imageSrc=t,this._image=new Image;let i=this;this._image.onload=function(){i.doChange("imageSrc")},this._image.src=this._imageSrc}}get imageFitMode(){return this._imageFitMode}set imageFitMode(t){this._imageFitMode!=t&&(this._imageFitMode=t,this.doChange("imageFitMode"))}get pathFitMode(){return this._pathFitMode}set pathFitMode(t){this._pathFitMode!=t&&(this._pathFitMode=t,this.doChange("fitmode"))}get paintKind(){return this._paintKind}set paintKind(t){this._paintKind!=t&&(this._paintKind=t,this.doChange("paintkind"))}get paintWidth(){return this._paintWidth}set paintWidth(t){this._paintWidth!=t&&(this._paintWidth=t,this.doChange("paintw"))}get paintHeight(){return this._paintHeight}set paintHeight(t){this._paintHeight!=t&&(this._paintHeight=t,this.doChange("painth"))}get patternIgnoreCount(){return this._patternIgnoreCount}set patternIgnoreCount(t){this._patternIgnoreCount!=t&&(this._patternIgnoreCount=t,this.doChange("patterni"))}get patternMargin(){return this._patternMargin}set patternMargin(t){this._patternMargin!=t&&(this._patternMargin=t,this.doChange("patternm"))}get patternKind(){return this._patternKind}set patternKind(t){this._patternKind!=t&&(this._patternKind=t,this.doChange("patternk"))}get paintRotateCount(){return this._paintRotateCount}set paintRotateCount(t){this._paintRotateCount!=t&&(this._paintRotateCount=t,this.doChange("paintRotateCount"))}get paintRotateStartAngle(){return this._paintRotateStartAngle}set paintRotateStartAngle(t){this._paintRotateStartAngle!=t&&(this._paintRotateStartAngle=t,this.doChange("paintRotateStartAngle"))}get paintRotateStopAngle(){return this._paintRotateStopAngle}set paintRotateStopAngle(t){this._paintRotateStopAngle!=t&&(this._paintRotateStopAngle=t,this.doChange("paintRotateStopAngle"))}get paintRotateRadiusX(){return this._paintRotateRadiusX}set paintRotateRadiusX(t){this._paintRotateRadiusX!=t&&(this._paintRotateRadiusX=t,this.doChange("paintRotateRadiusX"))}get paintRotateRadiusY(){return this._paintRotateRadiusY}set paintRotateRadiusY(t){this._paintRotateRadiusY!=t&&(this._paintRotateRadiusY=t,this.doChange("paintRotateRadiusY"))}get paintRotateApplyAngle(){return this._paintRotateApplyAngle}set paintRotateApplyAngle(t){this._paintRotateApplyAngle!=t&&(this._paintRotateApplyAngle=t,this.doChange("paintRotateApplyAngle"))}get randomCount(){return this._randomCount}set randomCount(t){this._randomCount!=t&&(this._randomCount=t,this.doChange("randomCount"))}get randomWidthMin(){return this._randomWidthMin}set randomWidthMin(t){this._randomWidthMin!=t&&(this._randomWidthMin=t,this.doChange("randomWidthMin"))}get randomWidthMax(){return this._randomWidthMax}set randomWidthMax(t){this._randomWidthMax!=t&&(this._randomWidthMax=t,this.doChange("randomWidthMax"))}get randomHeightMin(){return this._randomHeightMin}set randomHeightMin(t){this._randomHeightMin!=t&&(this._randomHeightMin=t,this.doChange("_randomHeightMin"))}get randomHeightMax(){return this._randomHeightMax}set randomHeightMax(t){this._randomHeightMax!=t&&(this._randomHeightMax=t,this.doChange("randomHeightMax"))}get filter(){return this._filter}set filter(t){this._filter!=t&&(this._filter=t,this.doChange(CCanvasItem.CON_CHANGE_FILTER))}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor!=t&&(this._shadowColor=t,this.doChange(CCanvasItem.CON_CHANGE_SHADOW_COLOR))}get shadowBlur(){return this._shadowBlur}set shadowBlur(t){this._shadowBlur!=t&&(this._shadowBlur=t,this.doChange(CCanvasItem.CON_CHANGE_SHADOW_BLUR))}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(t){this._shadowOffsetX!=t&&(this._shadowOffsetX=t,this.doChange(CCanvasItem.CON_CHANGE_SHADOW_OFFSET_X))}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(t){this._shadowOffsetY!=t&&(this._shadowOffsetY=t,this.doChange(CCanvasItem.CON_CHANGE_SHADOW_OFFSET_Y))}get composite(){return this._composite}set composite(t){this._composite!=t&&(this._composite=t,this.doChange("composite"))}doToData(t){super.doToData(t),CDataClass.putData(t,"align",this.align,ECanvasItemAlign.NONE),CDataClass.putData(t,"kind",this.kind,ECanvasItemKind.RECTANGLE),CDataClass.putData(t,"name",this.name,""),CDataClass.putData(t,"position",this.position.toData(),{},!0),CDataClass.putData(t,"positionUnit",this.positionUnit,EPositionUnit.PIXEL),CDataClass.putData(t,"rotationAngle",this.rotationAngle,0),CDataClass.putData(t,"rotationCenterX",this.rotationCenterX,.5),CDataClass.putData(t,"rotationCenterY",this.rotationCenterY,.5),CDataClass.putData(t,"margins",this.margins.toData(),{},!0),CDataClass.putData(t,"fill",this.fill.toData(),{},!0),CDataClass.putData(t,"stroke",this.stroke.toData(),{},!0),CDataClass.putData(t,"opacity",this.opacity,1),CDataClass.putData(t,"visible",this.visible,!0),CDataClass.putData(t,"pathData",this.pathData.toData(),{},!0),CDataClass.putData(t,"radiusX",this.radiusX,0),CDataClass.putData(t,"radiusY",this.radiusY,0),CDataClass.putData(t,"disableRoundSet",this.disableRoundSet.toData(),[],!0),CDataClass.putData(t,"disableLineSet",this.disableLineSet.toData(),[],!0),CDataClass.putData(t,"textSet",this.textSet.toData(),{},!0),CDataClass.putData(t,"text",this.text,""),CDataClass.putData(t,"paintKind",this.paintKind,EPaintKind.NORMAL),CDataClass.putData(t,"paintWidth",this.paintWidth,50),CDataClass.putData(t,"paintHeight",this.paintHeight,50),CDataClass.putData(t,"patternIgnoreCount",this.patternIgnoreCount,0),CDataClass.putData(t,"patternMargin",this.patternMargin,0),CDataClass.putData(t,"patternKind",this.patternKind,EPatternKind.ALL),CDataClass.putData(t,"paintRotateCount",this.paintRotateCount,5),CDataClass.putData(t,"paintRotateStartAngle",this.paintRotateStartAngle,-90),CDataClass.putData(t,"paintRotateStopAngle",this.paintRotateStopAngle,270),CDataClass.putData(t,"paintRotateRadiusX",this.paintRotateRadiusX,.5),CDataClass.putData(t,"paintRotateRadiusY",this.paintRotateRadiusY,.5),CDataClass.putData(t,"paintRotateApplyAngle",this.paintRotateApplyAngle,!0),CDataClass.putData(t,"randomCount",this.randomCount,10),CDataClass.putData(t,"randomWidthMin",this.randomWidthMin,10),CDataClass.putData(t,"randomWidthMax",this.randomWidthMax,100),CDataClass.putData(t,"randomHeightMin",this.randomHeightMin,10),CDataClass.putData(t,"randomHeightMax",this.randomHeightMax,100),CDataClass.putData(t,"filter",this.filter,""),CDataClass.putData(t,"shadowColor",this.shadowColor,""),CDataClass.putData(t,"shadowBlur",this.shadowBlur,0),CDataClass.putData(t,"shadowOffsetX",this.shadowOffsetX,0),CDataClass.putData(t,"shadowOffsetY",this.shadowOffsetY,0),CDataClass.putData(t,"pathFitMode",this.pathFitMode,EFitMode.STRETCH),CDataClass.putData(t,"imageSrc",this.imageSrc,""),CDataClass.putData(t,"imageFitMode",this.imageFitMode,EFitMode.FIT),CDataClass.putData(t,"composite",this.composite,"source-over")}doFromData(t){super.doFromData(t),this.align=CDataClass.getData(t,"align",ECanvasItemAlign.NONE),this.kind=CDataClass.getData(t,"kind",ECanvasItemKind.RECTANGLE),this.name=CDataClass.getData(t,"name",""),this.position.fromData(CDataClass.getData(t,"position",{},!0)),this.positionUnit=CDataClass.getData(t,"positionUnit",EPositionUnit.PIXEL),this.rotationAngle=CDataClass.getData(t,"rotationAngle",0),this.rotationCenterX=CDataClass.getData(t,"rotationCenterX",.5),this.rotationCenterY=CDataClass.getData(t,"rotationCenterY",.5),this.margins.fromData(CDataClass.getData(t,"margins",{},!0)),this.fill.fromData(CDataClass.getData(t,"fill",{},!0)),this.stroke.fromData(CDataClass.getData(t,"stroke",{},!0)),this.opacity=CDataClass.getData(t,"opacity",1),this.visible=CDataClass.getData(t,"visible",!0),this.pathData.fromData(CDataClass.getData(t,"pathData",{},!0)),this.radiusX=CDataClass.getData(t,"radiusX",0),this.radiusY=CDataClass.getData(t,"radiusY",0),this.disableRoundSet.fromData(CDataClass.getData(t,"disableRoundSet",[],!0)),this.disableLineSet.fromData(CDataClass.getData(t,"disableLineSet",[],!0)),this.textSet.fromData(CDataClass.getData(t,"textSet",{},!0)),this.text=CDataClass.getData(t,"text",""),this.paintKind=CDataClass.getData(t,"paintKind",EPaintKind.NORMAL),this.paintWidth=CDataClass.getData(t,"paintWidth",50),this.paintHeight=CDataClass.getData(t,"paintHeight",50),this.patternIgnoreCount=CDataClass.getData(t,"patternIgnoreCount",0),this.patternMargin=CDataClass.getData(t,"patternMargin",0),this.patternKind=CDataClass.getData(t,"patternKind",EPatternKind.ALL),this.paintRotateCount=CDataClass.getData(t,"paintRotateCount",5),this.paintRotateStartAngle=CDataClass.getData(t,"paintRotateStartAngle",-90),this.paintRotateStopAngle=CDataClass.getData(t,"paintRotateStopAngle",270),this.paintRotateRadiusX=CDataClass.getData(t,"paintRotateRadiusX",.5),this.paintRotateRadiusY=CDataClass.getData(t,"paintRotateRadiusY",.5),this.paintRotateApplyAngle=CDataClass.getData(t,"paintRotateApplyAngle",!0),this.randomCount=CDataClass.getData(t,"randomCount",10),this.randomWidthMin=CDataClass.getData(t,"randomWidthMin",10),this.randomWidthMax=CDataClass.getData(t,"randomWidthMax",100),this.randomHeightMin=CDataClass.getData(t,"randomHeightMin",10),this.randomHeightMax=CDataClass.getData(t,"randomHeightMax",100),this.filter=CDataClass.getData(t,"filter",""),this.shadowColor=CDataClass.getData(t,"shadowColor",""),this.shadowBlur=CDataClass.getData(t,"shadowBlur",0),this.shadowOffsetX=CDataClass.getData(t,"shadowOffsetX",0),this.shadowOffsetY=CDataClass.getData(t,"shadowOffsetY",0),this.pathFitMode=CDataClass.getData(t,"pathFitMode",EFitMode.STRETCH),this.imageSrc=CDataClass.getData(t,"imageSrc",""),this.imageFitMode=CDataClass.getData(t,"imageFitMode",EFitMode.FIT),this.composite=CDataClass.getData(t,"composite","source-over")}setAlign(t,i){let e=this.position,a=0,n=0;switch(this._align){case ECanvasItemAlign.NONE:t.copyFrom(e.rect),t.offset(i.left,i.top);break;case ECanvasItemAlign.LEFT:t.set(i.left+this.margins.left,i.top+this.margins.top,i.left+this.margins.left+e.width,i.bottom-this.margins.bottom);break;case ECanvasItemAlign.TOP:t.set(i.left+this.margins.left,i.top+this.margins.top,i.right-this.margins.right,i.top+this.margins.top+e.height);break;case ECanvasItemAlign.RIGHT:t.set(i.right-this.margins.right-e.width,i.top+this.margins.top,i.right-this.margins.right,i.bottom-this.margins.bottom);break;case ECanvasItemAlign.BOTTOM:t.set(i.left+this.margins.left,i.bottom-this.margins.bottom-e.height,i.right-this.margins.right,i.bottom-this.margins.bottom);break;case ECanvasItemAlign.CENTER:a=(i.width-e.width)/2+i.left,n=(i.height-e.height)/2+i.top,t.set(a,n,a+e.width,n+e.height);break;case ECanvasItemAlign.LEFTTOP:t.set(i.left+this.margins.left,i.top+this.margins.top,i.left+this.margins.left+e.width,i.top+this.margins.top+e.height);break;case ECanvasItemAlign.LEFTBOTTOM:t.set(i.left+this.margins.left,i.bottom-this.margins.bottom-e.height,i.left+this.margins.left+e.width,i.bottom-this.margins.bottom);break;case ECanvasItemAlign.RIGHTTOP:t.set(i.right-this.margins.right-e.width,i.top+this.margins.top,i.right-this.margins.right,i.top+this.margins.top+e.height);break;case ECanvasItemAlign.RIGHTBOTTOM:t.set(i.right-this.margins.right-e.width,i.bottom-this.margins.bottom-e.height,i.right-this.margins.right,i.bottom-this.margins.bottom);break;case ECanvasItemAlign.MIDDLELEFT:n=(i.height-e.height)/2+i.top,t.set(i.left+this.margins.left,n,i.left+this.margins.left+e.width,n+e.height);break;case ECanvasItemAlign.MIDDLETOP:a=(i.width-e.width)/2+i.left,t.set(a,i.top+this.margins.top,a+e.width,i.top+this.margins.top+e.height);break;case ECanvasItemAlign.MIDDLERIGHT:n=(i.height-e.height)/2+i.top,t.set(i.right-this.margins.right-e.width,n,i.right-this.margins.right,n+e.height);break;case ECanvasItemAlign.MIDDLEBOTTOM:a=(i.width-e.width)/2+i.left,t.set(a,i.bottom-this.margins.bottom-e.height,a+e.width,i.bottom-this.margins.bottom);break;case ECanvasItemAlign.HCENTER:a=(i.width-e.width)/2+i.left,t.set(a,i.top+this.margins.top,a+e.width,i.bottom-this.margins.bottom);break;case ECanvasItemAlign.VCENTER:n=(i.height-e.height)/2+i.top,t.set(i.left+this.margins.left,n,i.right-this.margins.right,n+e.height)}}draw(t,i,e,a=1,n=1){if(!this._visible||0==this._opacity)return;let o=new CRect(0,0,0,0);this.position.rect.isEmpty()?o=new CRect(i.left+this._margins.left,i.top+this._margins.top,i.right-this._margins.right,i.bottom-this._margins.bottom):this._positionUnit==EPositionUnit.PERCENT?(o.left=CCalc.cr(i.width,0,100,this.position.left,2),o.top=CCalc.cr(i.height,0,100,this.position.top,2),o.right=CCalc.cr(i.width,0,100,this.position.right,2),o.bottom=CCalc.cr(i.height,0,100,this.position.bottom,2),o.offset(i.left,i.top)):this.setAlign(o,i),t.save(),t.scale(a,n),t.globalAlpha=this.opacity,""!=this._filter&&(t.filter=this.filter),""!=this._shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.globalCompositeOperation=this.composite;let s=o.left+o.width*this.rotationCenterX,h=o.top+o.height*this.rotationCenterY;t.translate(s,h),t.rotate(CCalc.cr(Math.PI,0,180,this.rotationAngle,2)),t.translate(-s,-h);let r=this;function C(i){r._fill.styleKind!=EStyleKind.EMPTY&&(r._fill.setContext(t,i),t.fill())}function l(i){r._stroke.styleKind!=EStyleKind.EMPTY&&r._stroke.lineWidth>0&&(r._stroke.setContext(t,i),t.stroke())}function g(t){let i=0,e=0,a=0,n=0;switch(r.patternKind){case EPatternKind.ALL:for(;;){if(e=0,a=0,0==r._patternIgnoreCount||i%(r._patternIgnoreCount+1)==0)for(;0!=r._patternIgnoreCount&&e%(r._patternIgnoreCount+1)!=0||t(o.left+e*r._paintWidth+e*r._patternMargin,o.top+i*r._paintHeight+i*r._patternMargin,r._paintWidth,r._paintHeight),e++,!((a+=r._paintWidth+r._patternMargin)>o.width););if(i++,(n+=r._paintHeight+r._patternMargin)>o.height)break}break;case EPatternKind.CHECK_HEAD:for(;;){for(e=0,a=0;(i%2==0&&e%2==0||i%2==1&&e%2==1)&&t(o.left+e*r._paintWidth+e*r._patternMargin,o.top+i*r._paintHeight+i*r._patternMargin,r._paintWidth,r._paintHeight),e++,!((a+=r._paintWidth+r._patternMargin)>o.width););if(i++,(n+=r._paintHeight+r._patternMargin)>o.height)break}break;case EPatternKind.CHECK_TAIL:for(;;){for(e=0,a=0;(i%2==0&&e%2==1||i%2==1&&e%2==0)&&t(o.left+e*r._paintWidth+e*r._patternMargin,o.top+i*r._paintHeight+i*r._patternMargin,r._paintWidth,r._paintHeight),e++,!((a+=r._paintWidth+r._patternMargin)>o.width););if(i++,(n+=r._paintHeight+r._patternMargin)>o.height)break}break;case EPatternKind.COLUMN:for(;0!=r._patternIgnoreCount&&e%(r._patternIgnoreCount+1)!=0||t(o.left+e*r._paintWidth+e*r._patternMargin,o.top+i*r._paintHeight+i*r._patternMargin,r._paintWidth,o.height),e++,!((a+=r._paintWidth+r._patternMargin)>o.width););break;case EPatternKind.ROW:for(;0!=r._patternIgnoreCount&&i%(r._patternIgnoreCount+1)!=0||t(o.left+e*r._paintWidth+e*r._patternMargin,o.top+i*r._paintHeight+i*r._patternMargin,o.width,r._paintHeight),i++,!((n+=r._paintHeight+r._patternMargin)>o.height););}}function d(t){let i=(r._paintRotateStopAngle-r._paintRotateStartAngle)/r._paintRotateCount,e=o.left+o.width*r.rotationCenterX,a=o.top+o.height*r.rotationCenterY,n=o.width*r._paintRotateRadiusX,s=o.height*r._paintRotateRadiusY,h=new CPoint(e,a);for(let e=0;e<r._paintRotateCount;e++){let a=e*i+r._paintRotateStartAngle,o=CPoint.getAngleToPoint(h,n,s,a);t(o.x,o.y,a,o.x-r._paintWidth/2,o.y-r._paintHeight/2,r._paintWidth,r._paintHeight)}}function P(t){for(let i=0;i<r._randomCount;i++){let i=360*Math.random(),e=o.width*r._paintRotateRadiusX,a=o.height*r._paintRotateRadiusY;-1!=r.randomWidthMin&&(e=(r.randomWidthMax-r.randomWidthMin)*Math.random()+r.randomWidthMin),-1!=r.randomHeightMin&&(a=(r.randomHeightMax-r.randomHeightMin)*Math.random()+r.randomHeightMin),t(i,o.left+Math.random()*(o.width-e),o.top+Math.random()*(o.height-a),e,a),CCalc.crRange2Value}}if(this._kind==ECanvasItemKind.RECTANGLE||this._kind==ECanvasItemKind.ROUNDRECTANGLE||this._kind==ECanvasItemKind.ELLIPSE||this._kind==ECanvasItemKind.ARC||this._kind==ECanvasItemKind.PATH)switch(this._stroke.lineWidth>0&&this._stroke.styleKind!=EStyleKind.EMPTY&&o.inflate(-this._stroke.lineWidth/2,-this._stroke.lineWidth/2),t.beginPath(),this._kind){case ECanvasItemKind.RECTANGLE:this.paintKind==EPaintKind.PATTERN?(g(function(i,e,a,n){r._pathData.clear(),r._pathData.makeRoundRectData(i,e,a,n,r._radiusX,r._radiusY,r._disableRoundSet,r._disableLineSet,!1),r._pathData.setPathData(t)}),C(o),l(o)):this.paintKind==EPaintKind.ROTATE?(d(function(i,e,a,n,o,s,h){r._pathData.clear(),r._pathData.makeRoundRectData(n,o,s,h,r._radiusX,r._radiusY,r._disableRoundSet,r._disableLineSet,!1),r._paintRotateApplyAngle&&r._pathData.rotate(new CPoint(i,e),a),r._pathData.setPathData(t)}),C(o),l(o)):this.paintKind==EPaintKind.RANDOM?(P(function(i,e,a,n,o){r._pathData.clear(),r._pathData.makeRoundRectData(e,a,n,o,r._radiusX,r._radiusY,r._disableRoundSet,r._disableLineSet,!1),r._pathData.setPathData(t)}),C(o),l(o)):(this._pathData.makeRoundRectData(o.left,o.top,o.width,o.height,this._radiusX,this._radiusY,this._disableRoundSet,this._disableLineSet,!0),this._pathData.setPathData(t),C(o),l(o));break;case ECanvasItemKind.ROUNDRECTANGLE:if(this.paintKind==EPaintKind.PATTERN){let i=0;i=(r.paintWidth,r.paintHeight,r.paintWidth/2),g(function(e,a,n,o){r._pathData.clear(),r._pathData.makeRoundRectData(e,a,n,o,i,i,new CStringSet,new CStringSet,!1),r._pathData.setPathData(t)}),C(o),l(o)}else if(this.paintKind==EPaintKind.ROTATE){let i=0;i=(r.paintWidth,r.paintHeight,r.paintWidth/2),d(function(e,a,n,o,s,h,C){r._pathData.clear(),r._pathData.makeRoundRectData(o,s,h,C,i,i,new CStringSet,new CStringSet,!1),r._paintRotateApplyAngle&&r._pathData.rotate(new CPoint(e,a),n),r._pathData.setPathData(t)}),C(o),l(o)}else if(this.paintKind==EPaintKind.RANDOM){let i=0;i=(r.paintWidth,r.paintHeight,r.paintWidth/2),P(function(e,a,n,o,s){r._pathData.clear(),r._pathData.makeRoundRectData(a,n,o,s,i,i,new CStringSet,new CStringSet,!1),r._pathData.setPathData(t)}),C(o),l(o)}else{let i=0;i=o.width>o.height?o.height/2:o.width/2,this._pathData.makeRoundRectData(o.left,o.top,o.width,o.height,i,i,new CStringSet,new CStringSet,!0),this._pathData.setPathData(t),C(o),l(o)}break;case ECanvasItemKind.ELLIPSE:if(this.paintKind==EPaintKind.PATTERN)g(function(i,e,a,n){r._pathData.clear(),r._pathData.makeEllipseData(i,e,a,n,!1),r._pathData.setPathData(t)}),C(o),l(o);else if(this.paintKind==EPaintKind.ROTATE){let i=0;i=(r.paintWidth,r.paintHeight,r.paintWidth/2),d(function(i,e,a,n,o,s,h){r._pathData.clear(),r._pathData.makeEllipseData(n,o,s,h,!1),r._paintRotateApplyAngle&&r._pathData.rotate(new CPoint(i,e),a),r._pathData.setPathData(t)}),C(o),l(o)}else this.paintKind==EPaintKind.RANDOM?(P(function(i,e,a,n,o){r._pathData.clear(),r._pathData.makeEllipseData(e,a,n,o,!1),r._pathData.setPathData(t)}),C(o),l(o)):(this._pathData.makeEllipseData(o.left,o.top,o.width,o.height),this._pathData.setPathData(t),C(o),l(o));break;case ECanvasItemKind.PATH:;if(this.paintKind==EPaintKind.PATTERN)g(function(i,e,a,n){let o;(o=r._pathFitMode==EFitMode.ORIGINAL?r._pathData.copyTo():r._pathFitMode==EFitMode.FIT?r._pathData.fitTo(new CRect(i,e,i+a,e+n)):r._pathData.stretchTo(new CRect(i,e,i+a,e+n))).setPathData(t)}),C(o),l(o);else if(this.paintKind==EPaintKind.ROTATE)d(function(i,e,a,n,o,s,h){let C;C=r._pathFitMode==EFitMode.ORIGINAL?r._pathData.copyTo():r._pathFitMode==EFitMode.FIT?r._pathData.fitTo(new CRect(n,o,n+s,o+h)):r._pathData.stretchTo(new CRect(n,o,n+s,o+h)),r._paintRotateApplyAngle&&C.rotate(new CPoint(i,e),a+90),C.setPathData(t)}),C(o),l(o);else if(this.paintKind==EPaintKind.RANDOM)P(function(i,e,a,n,o){let s;(s=r._pathFitMode==EFitMode.ORIGINAL?r._pathData.copyTo():r._pathFitMode==EFitMode.FIT?r._pathData.fitTo(new CRect(e,a,e+n,a+o)):r._pathData.stretchTo(new CRect(e,a,e+n,a+o))).rotate(new CPoint(e+n/2,a+o/2),i),s.setPathData(t)}),C(o),l(o);else{let i=function(t,i,e,a){let n;return n=r._pathFitMode==EFitMode.ORIGINAL?r._pathData.copyTo():r._pathFitMode==EFitMode.FIT?r._pathData.fitTo(new CRect(t,i,t+e,i+a)):r._pathData.stretchTo(new CRect(t,i,t+e,i+a))}(o.left,o.top,o.width,o.height);i.setPathData(t),C(i.getBounds()),l(i.getBounds())}}else if(this._kind==ECanvasItemKind.IMAGE&&null!=this._image){let i=this;if(t.globalAlpha=i.opacity,i.paintKind==EPaintKind.PATTERN)g(function(e,a,n,o){let s=new CRect(e,a,e+n,a+o),h=new CRect(0,0,i._image.width,i._image.height);s=s.getFitRect(h,!0),t.drawImage(i._image,s.left+e,s.top+a,s.width,s.height)});else if(i.imageFitMode==EFitMode.ORIGINAL)t.drawImage(i._image,o.left,o.top);else if(i.imageFitMode==EFitMode.FIT){let e=new CRect(0,0,i._image.width,i._image.height),a=o.getFitRect(e,!0);t.drawImage(i._image,o.left+a.left,o.top+a.top,a.width,a.height)}else t.drawImage(i._image,o.left,o.top,o.width,o.height)}this.paintKind==EPaintKind.NORMAL&&function(i){let a=r._text;"string"!=typeof a&&(a+=""),null!=a&&""!=a.trim()&&r._textSet.drawText(t,i,a,e)}(o),t.restore()}enumProperties(){let t=new Map;return t.set("align",CEnum.toArray(ECanvasItemAlign)),t.set("kind",CEnum.toArray(ECanvasItemKind)),t.set("patternKind",CEnum.toArray(EPatternKind)),t.set("positionUnit",CEnum.toArray(EPositionUnit)),t.set("pathFitMode",CEnum.toArray(EFitMode)),t.set("paintKind",CEnum.toArray(EPaintKind)),t.set("imageFitMode",CEnum.toArray(EFitMode)),t}addProperties(){let t=super.addProperties();return t.push({instance:this.pathData.transformer,propertyName:"pathDataTransfomer",readOnly:!1,enum:[]}),t}}class CCanvasItems extends CList{doToData(t){super.doToData(t);for(let i=0;i<this.length;i++)t.push(this.get(i).toData())}doFromData(t){super.doFromData(t),this.clear();for(let i=0;i<t.length;i++){this.addItem().fromData(t[i])}}addItem(){let t=new CCanvasItem,i=this;return t.onChange=function(t,e){i.doChange(e)},this.add(t),t}deleteItem(t){if(t instanceof CCanvasItem){for(let i=0;i<this.length;i++)if(this.get(i)==t){this.delete(i,1);break}}else for(let i=0;i<this.length;i++)if(this.get(i).name==t){this.delete(i,1);break}}getItem(t){let i=new Array;for(let e=0;e<this.length;e++)this.get(e).name==t&&i.push(this.get(e));return i}setText(t,i){for(let e=0;e<this.length;e++)this.get(e).name==t&&(this.get(e).text=i)}setObject(t){let i=Object.keys(t);for(let e=0;e<i.length;e++)this.setText(i[e],t[i[e]])}draw(t,i,e,a,n=1,o=1){if(null!=a){i.offset(e.x,e.y);for(let e=0;e<this.length;e++)this.get(e).visible&&this.get(e).draw(t,i,a,n,o)}}}class CCanvasLayer extends CNotifyChangeKindObject{constructor(t){super(),this._name="",this._items=new CCanvasItems,this._scaleX=1,this._scaleY=1,this._transform=new CTransform,this._visible=!0,this._offset=new CNotifyPoint(0,0),this._canvas=document.createElement("canvas"),this.isDraw=!0,this._parent=t,this._id=CSequence.getSequence("layer");let i=this;this._offset.onChange=function(){i.doChange(CCanvasLayer.CON_CHANGE_OFFSET)},this._items.onChange=function(){i.doChange(CCanvasLayer.CON_CHANGE_ITEMS)},this._canvas=document.createElement("canvas"),this._canvas.style.outline="none",this._canvas.style.position="absolute",this._canvas.style.margin="0px 0px 0px 0px",this._canvas.style.padding="0px 0px 0px 0px",this._canvas.style.pointerEvents="none",this._canvas.setAttribute("ondragstart","return false"),this._canvas.setAttribute("onselectstart","return false"),this._canvas.setAttribute("oncontextmenu","return false");let e=this._canvas.getContext("2d");null!=e&&(this._context=e),null!=this._parent&&(this._parent instanceof HTMLElement?this._parent.appendChild(this._canvas):null!=this._parent.parent&&this._parent.parent.controlElement.appendChild(this._canvas)),this._transform.onChange=function(t,e){i.transform.setTransform(i.canvas)},this.transform.setTransform(this.canvas)}static get CON_CHANGE_ITEMS(){return"i"}static get CON_CHANGE_OFFSET(){return"o"}static get CON_CHANGE_VISIBLE(){return"v"}static get CON_CHANGE_SCALE_X(){return"sx"}static get CON_CHANGE_SCALE_Y(){return"sy"}get id(){return this._id}get items(){return this._items}get name(){return this._name}set name(t){this._name!=t&&(this._name=t,this.doChange("name"))}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX!=t&&(this._scaleX=t,this.doChange(CCanvasLayer.CON_CHANGE_SCALE_X))}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY!=t&&(this._scaleY=t,this.doChange(CCanvasLayer.CON_CHANGE_SCALE_Y))}set scale(t){this.scaleX=t,this.scaleY=t}get transform(){return this._transform}get canvas(){return this._canvas}get context(){return this._context}get offset(){return this._offset}get visible(){return this._visible}set visible(t){this._visible!=t&&(this._visible=t,this.doChange(CCanvasLayer.CON_CHANGE_VISIBLE))}doToData(t){super.doToData(t),CDataClass.putData(t,"name",this.name,""),CDataClass.putData(t,"items",this.items.toData(),[],!0),CDataClass.putData(t,"transform",this.transform.toData(),{},!0),CDataClass.putData(t,"visible",this.visible,!0),CDataClass.putData(t,"offset",this.offset.toData(),{},!0),CDataClass.putData(t,"width",this.canvas.width,0),CDataClass.putData(t,"height",this.canvas.height,0)}doFromData(t){super.doFromData(t),this.name=CDataClass.getData(t,"name",""),this.items.fromData(CDataClass.getData(t,"items",[],!0)),this.transform.fromData(CDataClass.getData(t,"transform",{},!0)),this.visible=CDataClass.getData(t,"visible",!0),this.offset.fromData(CDataClass.getData(t,"offset",{},!0)),this.canvas.width=CDataClass.getData(t,"width",0),this.canvas.height=CDataClass.getData(t,"height",0)}doChange(t){super.doChange(t),t==CCanvasLayer.CON_CHANGE_VISIBLE&&(this.visible?(null!=this.canvas&&(this.canvas.style.visibility="visible"),this.draw()):(null!=this.canvas&&(this.canvas.style.visibility="hidden"),CSystem.requestDraw.delete(this))),t!=CCanvasLayer.CON_CHANGE_OFFSET&&t!=CCanvasLayer.CON_CHANGE_ITEMS||this.draw(),t!=CCanvasLayer.CON_CHANGE_SCALE_X&&t!=CCanvasLayer.CON_CHANGE_SCALE_Y||this.doChangeScale()}doRemove(){this.canvas.remove(),super.doRemove()}doChangeScale(){this._parent instanceof CCanvasLayers&&null!=this._parent.parent&&this.doSetCanvasElementPosition(0,0,this._parent.parent.position.width,this._parent.parent.position.height),this.draw()}doSetCanvasElementPosition(t,i,e,a){this._canvas.width=e*this.scaleX,this._canvas.height=a*this.scaleY,this._canvas.style.left=(e-this._canvas.width)/2+"px",this._canvas.style.top=(a-this._canvas.height)/2+"px",this.draw()}setCanvasElementPosition(t,i,e,a){this.doSetCanvasElementPosition(t,i,e,a)}addItem(){return this._items.addItem()}doDraw(){if(null!=this._context&&this.canvas.width>0&&this.canvas.height>0&&this.visible){if(this._context.clearRect(0,0,this.canvas.width,this.canvas.height),null!=CSystem.bufferingContext){let t=new CRect(0,0,this.canvas.width/this.scaleX,this.canvas.height/this.scaleY);this.items.draw(this._context,t,this.offset,CSystem.bufferingContext,this.scaleX,this.scaleY)}null!=this.onDraw&&this.onDraw(this,this._context)}}draw(){this.visible&&this.isDraw&&CSystem.requestDraw.add(this)}getCanvasItems(t){let i=new Array,e=this.items.getItem(t);for(let t=0;t<e.length;t++)i.push(e[t]);return i}}class CCanvasLayers extends CList{constructor(t){super(),this._parent=t}static get CON_CHANGE_ADD_LAYER(){return"addlayer"}static get CON_CHANGE_LAYER(){return"layer"}get parent(){return this._parent}set scaleX(t){for(let i=0;i<this.length;i++)this.get(i).scaleX=t}set scaleY(t){for(let i=0;i<this.length;i++)this.get(i).scaleY=t}set scale(t){for(let i=0;i<this.length;i++)this.get(i).scale=t}doChangeLayer(t,i){this.useChangeEvent&&null!=this.onChangeLayer&&this.onChangeLayer(this,t,i)}doResource(){super.doResource(),null!=this._parent&&this._parent.setLayers()}doToData(t){super.doToData(t);for(let i=0;i<this.length;i++)t.push(this.get(i).toData())}doFromData(t){super.doFromData(t),this.clear();for(let i=0;i<t.length;i++){this.addLayer().fromData(t[i])}null!=this.parent&&this.parent.doSetLayers()}doRemove(){for(let t=this.length-1;t>=0;t--)this.get(t).remove();this.clear(),super.doRemove()}addLayer(){let t=new CCanvasLayer(this),i=this;return t.onChange=function(e){i.doChangeLayer(CCanvasLayers.CON_CHANGE_LAYER,t)},t.onDraw=function(t,e){if(null!=i.parent){let a=-1;for(let e=0;e<i.length;e++)if(t==i.get(e)){a=e;break}i.parent.doLayerDraw(a,t,e)}},i.doChangeLayer(CCanvasLayers.CON_CHANGE_ADD_LAYER,t),this.add(t),t}deleteLayer(t){if(t instanceof CCanvasLayer){for(let i=0;i<this.length;i++)if(this.get(i)==t){this.get(i).remove(),this.delete(i,1);break}}else for(let i=0;i<this.length;i++)if(this.get(i).id==t){this.get(i).remove(),this.delete(i,1);break}}clear(){for(let t=0;t<this.length;t++)this.get(t).remove();super.clear()}getLayer(t){let i;for(let e=0;e<this.length;e++)if(this.get(e).id==t){i=this.get(e);break}return i}getLayerFromName(t){let i;for(let e=0;e<this.length;e++)if(this.get(e).name==t){i=this.get(e);break}return i}setLayersPosition(t,i,e,a){for(let n=0;n<this.length;n++)this.get(n).setCanvasElementPosition(t,i,e,a)}draw(){for(let t=0;t<this.length;t++)this.get(t).draw()}getCanvasItems(t){let i=new Array;for(let e=0;e<this.length;e++){let a=this.get(e).getCanvasItems(t);for(let t=0;t<a.length;t++)i.push(a[t])}return i}getPathDataOrgSize(){let t={width:0,height:0};for(let i=0;i<this.length;i++)this.get(i).items.length>0&&(t.width=this.get(i).items.get(0).pathData.width,t.height=this.get(i).items.get(0).pathData.height);return t}static setLayersMiddlePathData(t,i,e,a){for(let n=0;n<e.length;n++)for(let o=0;o<e.get(n).items.length;o++)if(t.get(n).items.length>o&&i.get(n).items.length>o){let s=t.get(n).items.get(o).pathData,h=i.get(n).items.get(o).pathData,r=e.get(n).items.get(o).pathData;for(let t=0;t<r.length;t++)r.get(t).point.x=CCalc.crRange2Value(0,1,a,s.get(t).point.x,h.get(t).point.x),r.get(t).point.y=CCalc.crRange2Value(0,1,a,s.get(t).point.y,h.get(t).point.y),r.get(t).cPoint1.x=CCalc.crRange2Value(0,1,a,s.get(t).cPoint1.x,h.get(t).cPoint1.x),r.get(t).cPoint1.y=CCalc.crRange2Value(0,1,a,s.get(t).cPoint1.y,h.get(t).cPoint1.y),r.get(t).cPoint2.x=CCalc.crRange2Value(0,1,a,s.get(t).cPoint2.x,h.get(t).cPoint2.x),r.get(t).cPoint2.y=CCalc.crRange2Value(0,1,a,s.get(t).cPoint2.y,h.get(t).cPoint2.y);r.width=CCalc.crRange2Value(0,1,a,s.width,h.width),r.height=CCalc.crRange2Value(0,1,a,s.height,h.height)}}}